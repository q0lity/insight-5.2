/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var M=(h,e)=>{for(var a in e)f(h,a,{get:e[a],enumerable:!0})},C=(h,e,a,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of S(e))!E.call(h,t)&&t!==a&&f(h,t,{get:()=>e[t],enumerable:!(i=v(e,t))||i.enumerable});return h};var b=h=>C(f({},"__esModule",{value:!0}),h);var Y={};M(Y,{default:()=>g});module.exports=b(Y);var y=require("obsidian");var p=class{constructor(e,a,i,t){if(this.container=e,this.data=a,this.options=i,this.onUpdate=t,Object.keys(this.data.goals).length===0){let n=new Date;this.currentYear=n.getFullYear(),this.currentMonth=n.getMonth()}else{let n=new URLSearchParams(window.location.hash.slice(1));this.currentYear=parseInt(n.get("year")||new Date().getFullYear().toString()),this.currentMonth=parseInt(n.get("month")||new Date().getMonth().toString())}}async updateGoal(e,a){this.data.goals[e]=!a,await this.onUpdate(this.data)}updateUrlParams(){let e=new URLSearchParams(window.location.hash.slice(1));e.set("year",this.currentYear.toString()),e.set("month",this.currentMonth.toString()),window.history.replaceState(null,"",`#${e.toString()}`)}navigateToDate(e,a){this.currentYear=e,a!==void 0&&(this.currentMonth=a),this.updateUrlParams(),this.render()}calculateStreak(){if(!this.options.showStreak)return 0;let e=Object.entries(this.data.goals).filter(([i,t])=>t).map(([i])=>i).sort();if(e.length===0)return 0;let a=new Date;if(a.setHours(0,0,0,0),this.options.type==="daily"){let i=e.map(r=>new Date(r)).sort((r,s)=>s.getTime()-r.getTime()),t=0,n=null;for(let r of i){if(r>a)continue;if(!n){t=1,n=r;continue}if(Math.round((n.getTime()-r.getTime())/(1e3*60*60*24))===1)t++,n=r;else break}return t}else if(this.options.type==="weekly"){let i=e.filter(r=>r.includes("-W")).sort((r,s)=>s.localeCompare(r)),t=0,n=null;for(let r of i){let[s,l]=r.split("-W").map(Number);if(!n){t=1,n=r;continue}let[o,c]=n.split("-W").map(Number);if(s===o&&l===c-1||s===o-1&&c===1&&l===52)t++,n=r;else break}return t}else if(this.options.type==="monthly"){let i=e.sort((r,s)=>s.localeCompare(r)),t=0,n=null;for(let r of i){let[s,l]=r.split("-").map(Number);if(!n){t=1,n=r;continue}let[o,c]=n.split("-").map(Number);if(s===o&&l===c-1||s===o-1&&c===1&&l===12)t++,n=r;else break}return t}return 0}renderStreakCounter(){if(!this.options.showStreak)return;let e=this.calculateStreak(),a=this.container.createEl("div",{cls:"goal-tracker-streak"}),i=this.options.type==="daily"?"day":this.options.type==="weekly"?"week":"month";a.createEl("span",{text:`Current streak: ${e} ${i}${e!==1?"s":""}`})}render(){switch(this.container.empty(),this.container.createEl("h3",{text:this.options.title,cls:"goal-tracker-title"}),this.renderStreakCounter(),this.renderCalendarControls(),this.options.type){case"monthly":this.renderMonthlyView();break;case"weekly":this.renderWeeklyView();break;case"daily":default:this.renderDailyView()}}renderMonthlyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar monthly"});for(let a=0;a<12;a++){let i=(a+1).toString().padStart(2,"0"),t=`${this.currentYear}-${i}`,n=this.data.goals[t]??!1,r=e.createEl("div",{cls:`calendar-cell ${n?"completed":""}`,text:new Date(2024,a).toLocaleString("default",{month:"short"})});r.addEventListener("click",async()=>{this.data.goals[t]=!n,await this.onUpdate(this.data),r.toggleClass("completed",!n)})}}renderWeeklyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar weekly"}),a=new Date(this.currentYear,this.currentMonth,1),i=new Date(this.currentYear,this.currentMonth+1,0),t=new Date(a),n=t.getDay();for(t.setDate(t.getDate()-(n===0?6:n-1));t<=i;){let r=new Date(t);r.setDate(r.getDate()+6);let s=this.getWeekNumber(t),l=this.getWeekYear(t),o=new Date(t);if(o.setDate(o.getDate()+3),o.getMonth()===this.currentMonth&&o.getFullYear()===this.currentYear){let d=e.createEl("div",{cls:"week-row"}),u=`${l}-W${s}`,m=this.data.goals[u]??!1,D=`${t.getDate()} ${t.toLocaleString("default",{month:"short"})} - ${r.getDate()} ${r.toLocaleString("default",{month:"short"})}`,k=d.createEl("div",{cls:"week-info"});k.createEl("span",{text:`Week ${s}`,cls:"week-number"}),k.createEl("span",{text:D,cls:"week-dates"});let w=d.createEl("div",{cls:`calendar-cell ${m?"completed":""}`});w.addEventListener("click",async()=>{this.data.goals[u]=!m,await this.onUpdate(this.data),w.toggleClass("completed",!m)})}t.setDate(t.getDate()+7)}}renderDailyView(){let e=this.container.createEl("div",{cls:"goal-tracker-calendar"}),a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=e.createEl("div",{cls:"calendar-row"});a.forEach(o=>{i.createEl("div",{cls:"calendar-cell header",text:o})});let t=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0).getDate(),s=t.getDay(),l=e.createEl("div",{cls:"calendar-row"});for(let o=0;o<s;o++)l.createEl("div",{cls:"calendar-cell empty"});for(let o=1;o<=r;o++){(o+s-1)%7===0&&o!==1&&(l=e.createEl("div",{cls:"calendar-row"}));let c=`${this.currentYear}-${(this.currentMonth+1).toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`,d=this.data.goals[c]??!1,u=l.createEl("div",{cls:`calendar-cell ${d?"completed":""}`,text:o.toString()});u.addEventListener("click",async()=>{this.data.goals[c]=!d,await this.onUpdate(this.data),u.toggleClass("completed",!d)})}}getWeekYear(e){let a=new Date(e);return a.setDate(a.getDate()+3-(a.getDay()+6)%7),a.getFullYear()}getWeekNumber(e){let a=new Date(e.valueOf()),i=(e.getDay()+6)%7;a.setDate(a.getDate()-i+3);let t=a.valueOf();return a.setMonth(0,1),a.getDay()!==4&&a.setMonth(0,1+(4-a.getDay()+7)%7),1+Math.ceil((t-a.valueOf())/6048e5)}renderCalendarControls(){let e=this.container.createEl("div",{cls:"goal-tracker-controls"}),a=e.createEl("button",{text:"←"}),i=e.createEl("span",{text:this.currentYear.toString(),cls:"year-display"}),t=e.createEl("button",{text:"→"});if(this.options.type==="monthly"){a.addEventListener("click",()=>{this.navigateToDate(this.currentYear-1)}),t.addEventListener("click",()=>{this.navigateToDate(this.currentYear+1)});return}let n=e.createEl("select");["January","February","March","April","May","June","July","August","September","October","November","December"].forEach((s,l)=>{let o=n.createEl("option",{text:s,value:l.toString()});l===this.currentMonth&&(o.selected=!0)}),n.addEventListener("change",s=>{this.navigateToDate(this.currentYear,parseInt(s.target.value))}),a.addEventListener("click",()=>{this.currentMonth===0?this.navigateToDate(this.currentYear-1,11):this.navigateToDate(this.currentYear,this.currentMonth-1),n.value=this.currentMonth.toString()}),t.addEventListener("click",()=>{this.currentMonth===11?this.navigateToDate(this.currentYear+1,0):this.navigateToDate(this.currentYear,this.currentMonth+1),n.value=this.currentMonth.toString()})}};var g=class extends y.Plugin{async onload(){this.registerMarkdownCodeBlockProcessor("goal-calendar",async(e,a,i)=>{let t,n={type:"daily",title:"Goal tracker",showStreak:!1};try{let s=e.trim().split(`
`);for(;s.length>0&&s[0].includes(":");){let[o,c]=s[0].split(":"),d=o.trim(),u=c.trim();d==="type"?n.type=u:d==="title"?n.title=u:d==="streak"&&(n.showStreak=u.toLowerCase()==="on"),s.shift()}let l=s.join(`
`);l.trim()?t=JSON.parse(l):t={id:crypto.randomUUID(),type:n.type,title:n.title,goals:{}},t.title=n.title}catch(s){console.error("Failed to parse calendar data",s),t={id:crypto.randomUUID(),type:n.type,title:n.title,goals:{}}}new p(a,t,n,async s=>{let l=this.app.vault.getAbstractFileByPath(i.sourcePath);if(!(l instanceof y.TFile)){console.error("Could not find source file");return}await this.app.vault.process(l,o=>{let c=i.getSectionInfo(a);return c?this.updateCalendarBlock(o,c,s,n):(console.error("Could not find section info"),o)})}).render()})}updateCalendarBlock(e,a,i,t){let n=e.split(`
`),r=a.lineStart,s=a.lineEnd,l=n.slice(0,r+1).join(`
`),o=n.slice(s).join(`
`),c=[`type: ${t.type}`,`title: ${t.title}`,t.showStreak?"streak: on":null].filter(Boolean).join(`
`);return`${l}
${c}
${JSON.stringify(i,null,2)}
${o}`}};

/* nosourcemap */