/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ts=Object.defineProperty;var Xi=Object.getOwnPropertyDescriptor;var Ki=Object.getOwnPropertyNames;var Zi=Object.prototype.hasOwnProperty;var Yi=(s,e)=>{for(var t in e)Ts(s,t,{get:e[t],enumerable:!0})},Qi=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ki(e))!Zi.call(s,r)&&r!==t&&Ts(s,r,{get:()=>e[r],enumerable:!(n=Xi(e,r))||n.enumerable});return s};var ea=s=>Qi(Ts({},"__esModule",{value:!0}),s);var Uo={};Yi(Uo,{default:()=>Ss});module.exports=ea(Uo);var ke=require("obsidian");var Fr=require("obsidian");var Fs={confirm:"Confirm",yes:"Yes",no:"No",llmLoading:"LLM is thinking...",noResult:"LLM no result",pleaseOpenFile:"Please open a file first",llmError:"An error occurred, please try again later",inputPrompt:"Please enter the prompt",chatButton:"Chat",pleaseSelectText:"Please select the text to be processed first",currentFileNotMarkdown:"The current file is not a markdown file",fileAlreadyContainsTagsAndDescription:"The file already contains tags and description",parseError:"Failed to parse the returned result",metaUpdated:"Meta data updated",llmSettings:"LLM",llmSettingsDesc:"Configure LLM service settings",apiKey:"API key",baseUrl:"Base URL",modelName:"Model name",testLlmConnection:"Test LLM Connection",testLlmConnectionDesc:"Test whether the current LLM configuration can connect normally",testConnection:"Test Connection",testing:"Testing...",connectionSuccess:"Connection successful! LLM service is working properly",connectionFailed:"Connection failed",connectionError:"Connection error",apiKeyEmpty:"API Key cannot be empty",modelNameEmpty:"Model name cannot be empty",connectionTestPrompt:"Please reply 'Connection test successful' and nothing else.",apiResponseEmpty:"API connection failed or no response received",metaSetting:"Meta",metaSettingDesc:"Automatically generate file metadata",metaUpdateSetting:"Update meta",updateMetaOptions:"Update",updateMetaOptionsDesc:"If meta already exists, choose whether to regenerate",updateForce:"Force update existing items",updateNoLLM:"Only update items that do not use LLM",alreadyContainsMetadata:"Data already contains meta info",truncateSettings:"Content truncation",truncateContent:"Truncate long content?",truncateContentDesc:"When using LLM, whether to truncate if the file content exceeds the maximum word count",maxContentLength:"Max content length after truncation",maxContentLengthDesc:"Set the maximum token limit for the content",truncateMethod:"Truncation method",truncateMethodDesc:"Choose how to handle content that exceeds the limit",head_only:"Extract only the beginning",head_tail:"Extract the beginning and the end",heading:"Extract the heading and the text below it",taggingOptions:"Tags",taggingOptionsDesc:"Automatically generating tags",extractTags:"Extract tags",extractTagsDesc:"Extract tags that appear more than twice from all notes and fill them in the candidate box",extract:"Extract",tagList:"Tag list",tagListDesc:"Optional tag list, separated by line breaks",metaTagsPrompt:"Tags Generation Prompt",metaTagsPromptDesc:"The prompt for generating tags, where you can set the language, capitalization, etc.",defaultTagsPrompt:"Please extract up to three tags based on the following article content, and in the same language as the content.",tagsFieldName:"Tags field name",tagsFieldNameDesc:"Field name used for automatically generating tags (default: tags)",simplifyTagsConfirm:"The current tag list contains {count} tokens, do you want to use AI to simplify it?",simplifyTagsPrompt:'Please simplify the following tag list to no more than {count} most important tags, and return in JSON format as {"tags": ["tag1", "tag2", ...]}, without any other content. The tag list is as follows:',tagsSimplified:"Simplified to {count} tags, using approximately {tokens} tokens",description:"Description",descriptionPrompt:"Prompt",descriptionPromptDesc:"Prompt for generating descriptions",defaultSummaryPrompt:"Summarize the core content of the article directly without using phrases like 'this article.' The summary should be no more than 50 words, and in the same language as the content.",descriptionFieldName:"Description field name",descriptionFieldNameDesc:"Field name used for automatically generating descriptions (default: description)",title:"Title",enableTitle:"Enable auto title generation",enableTitleDesc:"Enable to automatically generate document titles",titlePrompt:"Title prompt",titlePromptDesc:"Prompt for generating titles",defaultTitlePrompt:"Please generate a concise and clear title for this document, no more than 10 words, and do not use quotes.",titleFieldName:"Title field name",titleFieldNameDesc:"Field name used for automatically generating titles (default: title)",editTime:"Edit time",enableEditTime:"Enable auto update edit time",enableEditTimeDesc:"Enable to automatically update the edit time of the document",editTimeFormat:"Edit time format",editTimeFormatDesc:"Set the format of the edit time",updateTimeFieldName:"Update time field name",updateTimeFieldNameDesc:"Field name used for automatically updating the update time (default: updated)",createTimeFieldName:"Create time field name",createTimeFieldNameDesc:"Field name used for automatically updating the create time (default: created)",customMetadata:"Custom metadata",customMetadataDesc:"Add custom metadata fields, e.g.: author=Author Name",addField:"Add field",fieldKey:"Field name",fieldValue:"Field value",staticValue:"Static",promptValue:"Prompt",fieldPrompt:"Field generation prompt",categoryOptions:"Category",enableCategory:"Enable auto category",enableCategoryDesc:"Enable to automatically select category for documents",categoryFieldName:"Category field name",categoryFieldNameDesc:"Field name used for automatically generating category (default: category)",categoryList:"Category list",categoryListDesc:"Optional category list, separated by line breaks",metaCategoryPrompt:"Category prompt",metaCategoryPromptDesc:"Prompt for generating category",defaultCategoryPrompt:"Please select a suitable category for this document",categoryUnknown:"Unknown",defaultCategories:'["Travel", "Shopping", "Mood", "Book Review", "Tech & Knowledge", "Entertainment", "Papers to Read", "Ideas & Inspiration", "Todo", "Methodology", "Work Thoughts", "Investment", "Books to Read", "Personal Info", "Accounting", "Tasks", "Health", "Excerpts", "Daily Life", "Worldview", "Food"]',donate:"Donate",donateDesc:"Thank you for your support",supportThisPlugin:"Support this plugin",supportThisPluginDesc:"If you find this plugin helpful, consider buying me a coffee!",bugMeACoffee:"Buy me a coffee",exmemoAdjustMeta:"Generate meta data",exmemoSelectFolder:"Select a suitable folder for the current file",exmemoInsertMd:"Insert the selected text into the best position",exmemoLLMAssistant:"AI Editor",exmemoGenerateNext:"Generate next sentence",llmAssistantSetting:"AI Editor",llmAssistantSettingDesc:"Supports LLM dialogue, content editing, and continuation",llmAssistantDialogEdit:"Is the prompt editable?",llmAssistantDialogEditDesc:"Whether to allow editing of previously saved prompts. If allowed, please trigger the dialog through the button",appendToSelection:"Append after selection",prependToSelection:"Prepend before selection",replaceSelection:"Replace selection",rememberChoice:"Remember this choice",resultMode:"Result handling mode",resultModeDesc:"Choose how to handle LLM results",askEachTime:"Ask each time",chooseAction:"Please choose an action",allFolders:"All folders",noFolders:"No folders found",tooManyFolders_1:" has ",tooManyFolders_2:" subdirs, which is quite a lot. Continue?",searchDesc:"Filter folders by keyword",pleaseSelectFolder:"Please select a folder to start migrating",folderNotFound:"Folder not found: ",migrationSuccess:"Migration successful",folderSelectionSetting:"Folder selection",folderSelectionSettingDesc:"Select a suitable folder for the current file and migrate it. The selected folder will be used as the target folder for the current file.",excludedFolders:"Excluded folders",excludedFoldersDesc:"Select a suitable folder for the current file and migrate it. List the excluded target folders, separated by line breaks",insertContent:"Content to be inserted",foundFilesNeedProcess:"A total of {total} files are included, of which {count} files need to extract information. ",processCancelled:"Processing cancelled",processComplete:"Processed {count} files' meta information",cancel:"Cancel",ok:"OK",continue:"Continue",processing:"Processing",estimatedTokens:"Estimated consumption {tokens} token, do you want to extract information?",skip:"Skip LLM",createIndex:"ExMemo generate dir index",addPropsToSearchResults:"ExMemo batch add metadata",createIndexFromSearch:"ExMemo create index file",fileList:"File list",fileDetail:"File detail",noDescription:"No description",moc:"MOC",processingFiles:"Processing files",generatingIndex:"Generating index",processCompleteWithIndex:"Processed {count} files' meta information and generated {dirs} directory index",indexFileSetting:"Index file",indexFileSettingDesc:"Generate index files for directories/search results and summarize content",defaultIndexString:"Index file name",defaultIndexStringDesc:"Default string at the beginning of the index file name",indexExcludeFile:"Excluded files",indexExcludeFileDesc:"Specify files that do not need to generate meta information. Files containing specified keywords will be excluded. Use * as a wildcard and separate with commas.",indexExcludeDir:"Excluded directories",indexExcludeDirDesc:"Specify directories that do not need to be indexed. Directories containing specified keywords will be excluded. Use * as a wildcard and separate with commas.",foundDirsNeedIndex:"{dirs} directories that need to extract information.",failedToCreateIndex:"Failed to create index file",indexCreated:"Index created at {path}",indexUpdated:"Index updated at {path}",noFilesToProcess:"No files to process",indexFileDirectory:"Index File Directory",indexFileDirectoryDesc:"Directory where search index files will be saved. Default is root directory.",indexQueryNotSupported:"Regenerating index files from search results is not supported yet",promptManager:"Prompt Manager",addPrompt:"Add Prompt",addNewPrompt:"Add New Prompt",enterPrompt:"Enter prompt",editPrompt:"Edit Prompt",clearPrompts:"Clear Prompt",resetPrompt:"Reset Prompt",useCount:"Usage count",save:"Save",managePrompts:"Manage Prompts",managePromptsDesc:"Prompt manager for adding, deleting and editing prompts",openPromptManager:"Open Prompt Manager",clearPromptsConfirmation:"Clear Prompts Confirmation",clearPromptsWarning:"Clearing prompts will delete all custom prompts, do you want to continue?",clear:"Clear",coverImage:"Cover Image",enableCover:"Enable Cover Image",enableCoverDesc:"Add cover image to your notes",coverFieldName:"Cover Field Name",coverFieldNameDesc:"Field name used for cover image in frontmatter",coverUrl:"Default Cover URL",coverUrlDesc:"Default cover image URL to use when no image is found",useFirstImage:"Use First Image",useFirstImageDesc:"Automatically use the first image in the article as cover",importExportSettings:"Import/Export Settings",importExportSettingsDesc:"Import or export plugin settings",exportSettings:"Export Settings",exportSettingsDesc:"Export current settings to a JSON file",importSettings:"Import Settings",importSettingsDesc:"Import settings from a JSON file",export:"Export",import:"Import",settingsExported:"Settings exported",settingsImported:"Settings imported",invalidSettingsFile:"Invalid settings file",importSettingsWarning:"Importing will overwrite all current ExMemo Tools settings. Continue?",confirmationRequired:"Confirmation Required",cards:"Cards",zettelkastenOptions:"Zettelkasten Settings",zettelkastenPosition:"Insert Position",zettelkastenPositionDesc:"Choose where to insert the Zettelkasten content",documentTop:"Document Top",documentBottom:"Document Bottom",zettelkastenPrompt:"Zettelkasten Prompt",zettelkastenPromptDesc:"Prompt used to generate Zettelkasten note content. The system will generate based on the current document content.",exmemoCreateZettelkasten:"Generate a card",errorExtractingZettelkasten:"Error extracting Zettelkasten note",noActiveEditor:"No active editor found. Please open a markdown file first.",batchZettelkastenComplete:"Batch Zettelkasten creation complete. Successfully processed {successCount} files, failed {failCount} files.",zettelkastenCreated:"Zettelkasten note created successfully",insertCardsAt:"Insert Position",insertCardsAtDesc:"Choose where to insert Zettelkasten cards",beforeContent:"Before Content",afterContent:"After Content",regenerateExistingCards:"Regenerate Existing Cards",regenerateExistingCardsDesc:"Whether to regenerate existing Zettelkasten cards",cardsAlreadyExist:"Zettelkasten cards already exist",defaultZettelkastenPrompt:`Please generate a Zettelkasten-style summary based on the following note content, including:
1. Main concepts and ideas
2. Connections to other concepts
3. Possible applications`};var vs={confirm:"\u786E\u8BA4",yes:"\u662F",no:"\u5426",llmLoading:"LLM \u601D\u8003\u4E2D...",noResult:"LLM \u65E0\u7ED3\u679C",pleaseOpenFile:"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6",llmError:"LLM \u9519\u8BEF",inputPrompt:"\u8BF7\u8F93\u5165\u63D0\u793A\u8BCD",chatButton:"\u5BF9\u8BDD",pleaseSelectText:"\u8BF7\u5148\u9009\u62E9\u6587\u672C",currentFileNotMarkdown:"\u5F53\u524D\u6587\u4EF6\u4E0D\u662F markdown \u6587\u4EF6",fileAlreadyContainsTagsAndDescription:"\u6587\u4EF6\u5DF2\u7ECF\u5305\u542B\u6807\u7B7E\u548C\u63CF\u8FF0",parseError:"\u89E3\u6790\u9519\u8BEF",metaUpdated:"\u5143\u6570\u636E\u5DF2\u66F4\u65B0",llmSettings:"LLM",llmSettingsDesc:"\u914D\u7F6E LLM \u670D\u52A1\u7684\u76F8\u5173\u8BBE\u7F6E",apiKey:"API Key",baseUrl:"Base URL",modelName:"\u6A21\u578B\u540D\u79F0",testLlmConnection:"\u6D4B\u8BD5 LLM \u8FDE\u63A5",testLlmConnectionDesc:"\u6D4B\u8BD5\u5F53\u524D LLM \u914D\u7F6E\u662F\u5426\u80FD\u591F\u6B63\u5E38\u8FDE\u63A5",testConnection:"\u6D4B\u8BD5\u8FDE\u63A5",testing:"\u6D4B\u8BD5\u4E2D...",connectionSuccess:"\u8FDE\u63A5\u6210\u529F\uFF01LLM \u670D\u52A1\u8FD0\u884C\u6B63\u5E38",connectionFailed:"\u8FDE\u63A5\u5931\u8D25",connectionError:"\u8FDE\u63A5\u9519\u8BEF",apiKeyEmpty:"API Key\u4E0D\u80FD\u4E3A\u7A7A",modelNameEmpty:"\u6A21\u578B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",connectionTestPrompt:"\u8BF7\u56DE\u590D'\u8FDE\u63A5\u6D4B\u8BD5\u6210\u529F'\uFF0C\u4E0D\u8981\u56DE\u590D\u5176\u4ED6\u5185\u5BB9\u3002",apiResponseEmpty:"API\u8FDE\u63A5\u5931\u8D25\u6216\u672A\u8FD4\u56DE\u54CD\u5E94",metaSetting:"\u751F\u6210\u5143\u6570\u636E",metaSettingDesc:"\u81EA\u52A8\u751F\u6210\u6587\u4EF6\u7684\u5143\u6570\u636E",metaUpdateSetting:"\u66F4\u65B0\u5143\u6570\u636E",updateMetaOptions:"\u66F4\u65B0\u9009\u9879",updateMetaOptionsDesc:"\u5982\u679C\u5143\u6570\u636E\u5DF2\u7ECF\u5B58\u5728\uFF0C\u662F\u5426\u91CD\u65B0\u751F\u6210",updateForce:"\u5F3A\u5236\u66F4\u65B0\u5DF2\u5B58\u5728\u9879",updateNoLLM:"\u53EA\u66F4\u65B0\u4E0D\u7528LLM\u7684\u9879",alreadyContainsMetadata:"\u5DF2\u5305\u542B\u5143\u6570\u636E",truncateSettings:"\u5185\u5BB9\u622A\u65AD",truncateContent:"\u5185\u5BB9\u592A\u957F\u662F\u5426\u622A\u65AD",truncateContentDesc:"\u4F7F\u7528LLM\u65F6\uFF0C\u5982\u679C\u6587\u4EF6\u5185\u5BB9\u8D85\u8FC7\u6700\u5927\u5B57\u6570\uFF0C\u662F\u5426\u622A\u65AD",maxContentLength:"\u622A\u65AD\u540E\u6700\u5927\u5185\u5BB9\u957F\u5EA6",maxContentLengthDesc:"\u8BBE\u7F6E\u5185\u5BB9\u7684\u6700\u5927 token \u9650\u5236",truncateMethod:"\u622A\u65AD\u65B9\u5F0F",truncateMethodDesc:"\u9009\u62E9\u5185\u5BB9\u8D85\u8FC7\u9650\u5236\u65F6\u7684\u5904\u7406\u65B9\u5F0F",head_only:"\u4EC5\u63D0\u53D6\u5F00\u5934\u90E8\u5206",head_tail:"\u63D0\u53D6\u5F00\u5934\u548C\u7ED3\u5C3E\u90E8\u5206",heading:"\u63D0\u53D6\u6807\u9898\u53CA\u5176\u4E0B\u65B9\u7684\u6587\u5B57",taggingOptions:"\u6807\u7B7E",taggingOptionsDesc:"\u81EA\u52A8\u751F\u6210\u6807\u7B7E",extractTags:"\u63D0\u53D6\u6807\u7B7E",extractTagsDesc:"\u4ECE\u6240\u6709\u7B14\u8BB0\u4E2D\u63D0\u53D6\u51FA\u73B0\u8D85\u8FC7\u4E24\u6B21\u7684\u6807\u7B7E",extract:"\u63D0\u53D6",tagList:"\u6807\u7B7E\u5217\u8868",tagListDesc:"\u53EF\u9009\u6807\u7B7E\u5217\u8868\uFF0C\u4F7F\u7528\u56DE\u8F66\u5206\u9694",metaTagsPrompt:"\u6807\u7B7E\u751F\u6210\u63D0\u793A\u8BCD",metaTagsPromptDesc:"\u7528\u4E8E\u751F\u6210\u6807\u7B7E\u7684\u63D0\u793A\u8BCD\uFF0C\u53EF\u5728\u6B64\u8BBE\u7F6E\u8BED\u8A00\u3001\u5927\u5C0F\u5199\u7B49",defaultTagsPrompt:"\u8BF7\u63D0\u53D6\u8FD9\u7BC7\u6587\u7AE0\u4E2D\u6700\u5408\u9002\u7684\u4E0D\u8D85\u8FC7\u4E09\u4E2A\u6807\u7B7E\uFF0C\u5E76\u4F7F\u7528\u4E0E\u5185\u5BB9\u76F8\u540C\u7684\u8BED\u8A00\u3002",tagsFieldName:"\u6807\u7B7E\u5B57\u6BB5\u540D",tagsFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u6807\u7B7E\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: tags)",simplifyTagsConfirm:"\u5F53\u524D\u6807\u7B7E\u5217\u8868\u5305\u542B {count} \u4E2Atokens\uFF0C\u662F\u5426\u9700\u8981\u4F7F\u7528AI\u81EA\u52A8\u7CBE\u7B80\uFF1F",simplifyTagsPrompt:'\u8BF7\u5C06\u4EE5\u4E0B\u6807\u7B7E\u5217\u8868\u7CBE\u7B80\u5230{count}\u4E2A\u4EE5\u5185\u6700\u91CD\u8981\u7684\u6807\u7B7E\uFF0C\u5E76\u4EE5JSON\u683C\u5F0F\u8FD4\u56DE\uFF0C\u683C\u5F0F\u4E3A{"tags": ["\u6807\u7B7E1", "\u6807\u7B7E2", ...]}\uFF0C\u4E0D\u8981\u8FD4\u56DE\u4EFB\u4F55\u5176\u5B83\u5185\u5BB9\u3002\u6807\u7B7E\u5217\u8868\u5982\u4E0B\uFF1A',tagsSimplified:"\u5DF2\u7CBE\u7B80\u5230 {count} \u4E2A\u6807\u7B7E\uFF0C\u7EA6\u4F7F\u7528 {tokens} \u4E2Atoken",description:"\u63CF\u8FF0",descriptionPrompt:"\u63CF\u8FF0\u63D0\u793A\u8BCD",descriptionPromptDesc:"\u7528\u4E8E\u751F\u6210\u63CF\u8FF0\u7684\u63D0\u793A\u8BCD",defaultSummaryPrompt:"\u76F4\u63A5\u603B\u7ED3\u6587\u7AE0\u7684\u6838\u5FC3\u5185\u5BB9\uFF0C\u4E0D\u8981\u4F7F\u7528'\u8FD9\u7BC7\u6587\u7AE0'\u8FD9\u6837\u7684\u77ED\u8BED\uFF0C\u4E0D\u8D85\u8FC750\u4E2A\u5B57\uFF0C\u4E14\u4E0E\u5185\u5BB9\u4F7F\u7528\u76F8\u540C\u8BED\u8A00\u56DE\u7B54\u3002",descriptionFieldName:"\u63CF\u8FF0\u5B57\u6BB5\u540D",descriptionFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u63CF\u8FF0\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: description)",title:"\u6807\u9898",enableTitle:"\u542F\u7528\u81EA\u52A8\u751F\u6210\u6807\u9898",enableTitleDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u751F\u6210\u6587\u6863\u6807\u9898",titlePrompt:"\u6807\u9898\u751F\u6210\u63D0\u793A\u8BCD",titlePromptDesc:"\u7528\u4E8E\u751F\u6210\u6807\u9898\u7684\u63D0\u793A\u8BCD",defaultTitlePrompt:"\u8BF7\u4E3A\u8FD9\u7BC7\u6587\u6863\u751F\u6210\u4E00\u4E2A\u7B80\u6D01\u660E\u4E86\u7684\u6807\u9898\uFF0C\u4E0D\u8D85\u8FC710\u4E2A\u5B57\uFF0C\u4E0D\u8981\u4F7F\u7528\u5F15\u53F7\u3002",titleFieldName:"\u6807\u9898\u5B57\u6BB5\u540D",titleFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u6807\u9898\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: title)",editTime:"\u7F16\u8F91\u65F6\u95F4",enableEditTime:"\u542F\u7528\u81EA\u52A8\u66F4\u65B0\u7F16\u8F91\u65F6\u95F4",enableEditTimeDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u66F4\u65B0\u6587\u6863\u7684\u7F16\u8F91\u65F6\u95F4",editTimeFormat:"\u65F6\u95F4\u683C\u5F0F",editTimeFormatDesc:"\u7F16\u8F91\u65F6\u95F4\u7684\u683C\u5F0F\uFF0C\u4F7F\u7528 moment.js \u683C\u5F0F",updateTimeFieldName:"\u66F4\u65B0\u65F6\u95F4\u5B57\u6BB5\u540D",updateTimeFieldNameDesc:"\u81EA\u52A8\u66F4\u65B0\u7F16\u8F91\u65F6\u95F4\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: updated)",createTimeFieldName:"\u521B\u5EFA\u65F6\u95F4\u5B57\u6BB5\u540D",createTimeFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u521B\u5EFA\u65F6\u95F4\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: created)",customMetadata:"\u81EA\u5B9A\u4E49\u5143\u6570\u636E",customMetadataDesc:"\u6DFB\u52A0\u81EA\u5B9A\u4E49\u7684\u5143\u6570\u636E\u5B57\u6BB5\uFF0C\u5982\uFF1Aauthor=\u4F5C\u8005\u540D",addField:"\u6DFB\u52A0\u5B57\u6BB5",fieldKey:"\u5B57\u6BB5\u540D",fieldValue:"\u5B57\u6BB5\u503C",staticValue:"\u9759\u6001",promptValue:"\u63D0\u793A\u8BCD",fieldPrompt:"\u5B57\u6BB5\u751F\u6210\u63D0\u793A\u8BCD",categoryOptions:"\u7C7B\u522B",enableCategory:"\u542F\u7528\u81EA\u52A8\u5206\u7C7B",enableCategoryDesc:"\u542F\u7528\u540E\u5C06\u81EA\u52A8\u4E3A\u6587\u6863\u9009\u62E9\u7C7B\u522B",categoryFieldName:"\u7C7B\u522B\u5B57\u6BB5\u540D",categoryFieldNameDesc:"\u81EA\u52A8\u751F\u6210\u7C7B\u522B\u4F7F\u7528\u7684\u5B57\u6BB5\u540D (\u9ED8\u8BA4: category)",categoryList:"\u7C7B\u522B\u5217\u8868",categoryListDesc:"\u53EF\u9009\u7C7B\u522B\u5217\u8868\uFF0C\u4F7F\u7528\u56DE\u8F66\u5206\u9694",metaCategoryPrompt:"\u7C7B\u522B\u751F\u6210\u63D0\u793A\u8BCD",metaCategoryPromptDesc:"\u7528\u4E8E\u751F\u6210\u7C7B\u522B\u7684\u63D0\u793A\u8BCD",defaultCategoryPrompt:"\u8BF7\u4E3A\u8FD9\u7BC7\u6587\u6863\u9009\u62E9\u4E00\u4E2A\u5408\u9002\u7684\u7C7B\u522B",categoryUnknown:"\u672A\u5206\u7C7B",defaultCategories:'["\u65C5\u884C", "\u8D2D\u7269", "\u5FC3\u60C5", "\u8BFB\u540E\u611F", "\u77E5\u8BC6\u79D1\u6280", "\u5A31\u4E50", "\u5F85\u8BFB\u8BBA\u6587", "\u7075\u611F\u521B\u610F", "\u5F85\u529E\u4E8B\u9879", "\u65B9\u6CD5\u8BBA", "\u5DE5\u4F5C\u601D\u8003", "\u6295\u8D44", "\u5F85\u8BFB\u4E66", "\u4E2A\u4EBA\u4FE1\u606F", "\u8BB0\u5E10", "\u5F85\u505A", "\u5065\u5EB7", "\u6458\u5F55", "\u65E5\u5E38\u7410\u4E8B", "\u4E16\u754C\u89C2", "\u7F8E\u98DF"]',donate:"\u6350\u8D60",donateDesc:"\u611F\u8C22\u60A8\u7684\u652F\u6301",supportThisPlugin:"\u652F\u6301\u6B64\u63D2\u4EF6",supportThisPluginDesc:"\u5982\u679C\u60A8\u559C\u6B22\u8FD9\u4E2A\u63D2\u4EF6\uFF0C\u53EF\u4EE5\u8BF7\u6211\u559D\u676F\u5496\u5561",bugMeACoffee:"\u8BF7\u6211\u559D\u676F\u5496\u5561",exmemoAdjustMeta:"\u751F\u6210\u5143\u6570\u636E",exmemoSelectFolder:"\u4E3A\u5F53\u524D\u6587\u4EF6\u9009\u62E9\u5408\u9002\u7684\u76EE\u5F55",exmemoInsertMd:"\u5C06\u9009\u4E2D\u7684\u6587\u672C\u63D2\u5165\u5230 markdown \u5408\u9002\u4F4D\u7F6E",exmemoLLMAssistant:"\u667A\u80FD\u7F16\u8F91",exmemoGenerateNext:"\u7EED\u5199\u4E0B\u4E00\u53E5",llmAssistantSetting:"\u667A\u80FD\u7F16\u8F91",llmAssistantSettingDesc:"\u652F\u6301 LLM \u5BF9\u8BDD\u3001\u5185\u5BB9\u7F16\u8F91\u548C\u7EED\u5199",llmAssistantDialogEdit:"\u63D0\u793A\u8BCD\u662F\u5426\u53EF\u7F16\u8F91",llmAssistantDialogEditDesc:"\u662F\u5426\u5141\u8BB8\u7F16\u8F91\u4E4B\u524D\u4FDD\u5B58\u7684\u63D0\u793A\u8BCD\uFF1B\u5982\u679C\u5141\u8BB8\uFF0C\u5219\u9700\u8981\u901A\u8FC7\u6309\u94AE\u6765\u89E6\u53D1\u5BF9\u8BDD",appendToSelection:"\u6DFB\u52A0\u5230\u9009\u533A\u540E",prependToSelection:"\u6DFB\u52A0\u5230\u9009\u533A\u524D",replaceSelection:"\u66FF\u6362\u9009\u533A",rememberChoice:"\u8BB0\u4F4F\u6B64\u9009\u62E9",resultMode:"\u7ED3\u679C\u5904\u7406\u6A21\u5F0F",resultModeDesc:"\u9009\u62E9 LLM \u7ED3\u679C\u7684\u5904\u7406\u65B9\u5F0F",askEachTime:"\u6BCF\u6B21\u8BE2\u95EE",chooseAction:"\u8BF7\u9009\u62E9\u64CD\u4F5C",allFolders:"\u5168\u90E8\u76EE\u5F55",noFolders:"\u6CA1\u6709\u627E\u5230\u76EE\u5F55",tooManyFolders_1:"\u6709",tooManyFolders_2:"\u4E2A\u5F85\u9009\u5B50\u76EE\u5F55\uFF0C\u6570\u91CF\u8F83\u591A\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",searchDesc:"\u901A\u8FC7\u5173\u952E\u5B57\u8FC7\u6EE4\u76EE\u5F55",pleaseSelectFolder:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u76EE\u5F55\u5F00\u59CB\u8FC1\u79FB",folderNotFound:"\u672A\u627E\u5230\u76EE\u5F55\uFF1A",migrationSuccess:"\u8FC1\u79FB\u6210\u529F",folderSelectionSetting:"\u76EE\u5F55\u9009\u62E9",folderSelectionSettingDesc:"\u4E3A\u5F53\u524D\u6587\u4EF6\u9009\u62E9\u5408\u9002\u7684\u76EE\u5F55\uFF0C\u5E76\u8FC1\u79FB",excludedFolders:"\u6392\u9664\u76EE\u5F55",excludedFoldersDesc:"\u5217\u51FA\u6392\u9664\u7684\u76EE\u6807\u76EE\u5F55\uFF0C\u76EE\u5F55\u4E4B\u95F4\u7528\u56DE\u8F66\u5206\u9694",insertContent:"\u5F85\u63D2\u5165\u5185\u5BB9",foundFilesNeedProcess:"\u5171\u7EB3\u5165 {total} \u4E2A\u6587\u4EF6\uFF0C\u5176\u4E2D {count} \u4E2A\u6587\u4EF6\u9700\u8981\u63D0\u53D6\u4FE1\u606F\u3002",processCancelled:"\u5904\u7406\u5DF2\u53D6\u6D88",processComplete:"\u5DF2\u5904\u7406 {count} \u4E2A\u6587\u4EF6\u7684 Meta \u4FE1\u606F",cancel:"\u53D6\u6D88",continue:"\u7EE7\u7EED",processing:"\u5904\u7406\u4E2D",estimatedTokens:"\u9884\u8BA1\u6D88\u8017 {tokens} token\uFF0C\u662F\u5426\u7528\u6A21\u578B\u63D0\u53D6\u4FE1\u606F\uFF1F",skip:"\u8DF3\u8FC7 LLM \u63D0\u53D6",createIndex:"ExMemo\u751F\u6210\u76EE\u5F55\u7D22\u5F15",addPropsToSearchResults:"ExMemo\u6279\u91CF\u6DFB\u52A0\u5143\u6570\u636E",createIndexFromSearch:"ExMemo\u4ECE\u641C\u7D22\u7ED3\u679C\u521B\u5EFA\u7D22\u5F15",fileList:"\u6587\u4EF6\u5217\u8868",fileDetail:"\u6587\u4EF6\u8BE6\u60C5",noDescription:"\u6682\u65E0",moc:"\u76EE\u5F55",processingFiles:"\u5904\u7406\u6587\u4EF6",generatingIndex:"\u751F\u6210\u7D22\u5F15",processCompleteWithIndex:"\u5DF2\u5904\u7406 {count} \u4E2A\u6587\u4EF6\u7684 Meta \u4FE1\u606F\uFF0C\u5E76\u751F\u6210 {dirs} \u4E2A\u76EE\u5F55\u7D22\u5F15",indexFileSetting:"\u751F\u6210\u7D22\u5F15\u6587\u4EF6",indexFileSettingDesc:"\u4E3A\u76EE\u5F55/\u641C\u7D22\u7ED3\u679C\u751F\u6210\u7D22\u5F15\u6587\u4EF6\uFF0C\u5E76\u603B\u7ED3\u5185\u5BB9",defaultIndexString:"\u7D22\u5F15\u6587\u4EF6\u540D",defaultIndexStringDesc:"\u7D22\u5F15\u6587\u4EF6\u540D\u5F00\u5934\u7684\u9ED8\u8BA4\u5B57\u7B26\u4E32",indexExcludeFile:"\u6392\u9664\u7684\u6587\u4EF6",indexExcludeFileDesc:"\u6307\u5B9A\u4E0D\u9700\u8981\u751F\u6210Meta\u4FE1\u606F\u7684\u6587\u4EF6\uFF0C\u5305\u542B\u6307\u5B9A\u5173\u952E\u5B57\u7684\u6587\u4EF6\u5C06\u88AB\u6392\u9664\u3002\u4F7F\u7528 * \u4F5C\u4E3A\u901A\u914D\u7B26\uFF0C\u5E76\u7528\u9017\u53F7\u5206\u9694\u3002",indexExcludeDir:"\u6392\u9664\u7684\u76EE\u5F55",indexExcludeDirDesc:"\u6307\u5B9A\u4E0D\u9700\u8981\u5EFA\u7ACB\u7D22\u5F15\u7684\u76EE\u5F55\uFF0C\u5305\u542B\u6307\u5B9A\u5173\u952E\u5B57\u7684\u76EE\u5F55\u5C06\u88AB\u6392\u9664\u3002\u4F7F\u7528 * \u4F5C\u4E3A\u901A\u914D\u7B26\uFF0C\u5E76\u7528\u9017\u53F7\u5206\u9694\u3002",foundDirsNeedIndex:"{dirs} \u4E2A\u76EE\u5F55\u9700\u8981\u63D0\u53D6\u4FE1\u606F\u3002",failedToCreateIndex:"\u65E0\u6CD5\u521B\u5EFA\u7D22\u5F15",indexCreated:"\u521B\u5EFA\u7D22\u5F15\uFF1A{path}",indexUpdated:"\u66F4\u65B0\u7D22\u5F15\uFF1A{path}",noFilesToProcess:"\u6CA1\u6709\u9700\u8981\u5904\u7406\u7684\u6587\u4EF6",indexFileDirectory:"\u7D22\u5F15\u6587\u4EF6\u76EE\u5F55",indexFileDirectoryDesc:"\u641C\u7D22\u7ED3\u679C\u751F\u6210\u7684\u7D22\u5F15\u6587\u4EF6\u5B58\u653E\u7684\u76EE\u5F55\u3002\u9ED8\u8BA4\u4E3A\u6839\u76EE\u5F55\u3002",indexQueryNotSupported:"\u6682\u4E0D\u652F\u6301\u5BF9\u641C\u7D22\u7ED3\u679C\u91CD\u65B0\u751F\u6210\u7D22\u5F15\u6587\u4EF6",promptManager:"\u63D0\u793A\u8BCD\u7BA1\u7406",addPrompt:"\u6DFB\u52A0\u63D0\u793A\u8BCD",addNewPrompt:"\u6DFB\u52A0\u65B0\u63D0\u793A\u8BCD",enterPrompt:"\u8BF7\u8F93\u5165\u63D0\u793A\u8BCD",editPrompt:"\u7F16\u8F91\u63D0\u793A\u8BCD",clearPrompts:"\u6E05\u9664\u63D0\u793A\u8BCD",resetPrompt:"\u91CD\u7F6E\u63D0\u793A\u8BCD",useCount:"\u4F7F\u7528\u6B21\u6570",save:"\u4FDD\u5B58",managePrompts:"\u7BA1\u7406\u63D0\u793A\u8BCD",managePromptsDesc:"\u63D0\u793A\u8BCD\u7BA1\u7406\u5668\uFF0C\u652F\u6301\u6DFB\u52A0\u3001\u5220\u9664\u548C\u7F16\u8F91\u63D0\u793A\u8BCD",openPromptManager:"\u6253\u5F00\u63D0\u793A\u8BCD\u7BA1\u7406\u5668",clearPromptsConfirmation:"\u6E05\u9664\u63D0\u793A\u8BCD\u786E\u8BA4",clearPromptsWarning:"\u6E05\u9664\u63D0\u793A\u8BCD\u5C06\u5220\u9664\u6240\u6709\u81EA\u5B9A\u4E49\u63D0\u793A\u8BCD\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",clear:"\u6E05\u9664",coverImage:"\u5C01\u9762\u56FE",enableCover:"\u542F\u7528\u5C01\u9762\u56FE",enableCoverDesc:"\u4E3A\u7B14\u8BB0\u6DFB\u52A0\u5C01\u9762\u56FE",coverFieldName:"\u5C01\u9762\u56FE\u5B57\u6BB5\u540D",coverFieldNameDesc:"\u5728frontmatter\u4E2D\u4F7F\u7528\u7684\u5C01\u9762\u56FE\u5B57\u6BB5\u540D\u79F0",coverUrl:"\u9ED8\u8BA4\u5C01\u9762\u56FEURL",coverUrlDesc:"\u5F53\u672A\u627E\u5230\u56FE\u7247\u65F6\u4F7F\u7528\u7684\u9ED8\u8BA4\u5C01\u9762\u56FE\u5730\u5740",useFirstImage:"\u4F7F\u7528\u7B2C\u4E00\u5F20\u56FE\u7247",useFirstImageDesc:"\u81EA\u52A8\u4F7F\u7528\u6587\u7AE0\u4E2D\u7684\u7B2C\u4E00\u5F20\u56FE\u7247\u4F5C\u4E3A\u5C01\u9762\u56FE",importExportSettings:"\u5BFC\u5165/\u5BFC\u51FA\u8BBE\u7F6E",importExportSettingsDesc:"\u5BFC\u5165\u6216\u5BFC\u51FA\u63D2\u4EF6\u8BBE\u7F6E",exportSettings:"\u5BFC\u51FA\u8BBE\u7F6E",exportSettingsDesc:"\u5BFC\u51FA\u5F53\u524D\u8BBE\u7F6E\u4E3A JSON \u6587\u4EF6",importSettings:"\u5BFC\u5165\u8BBE\u7F6E",importSettingsDesc:"\u4ECE JSON \u6587\u4EF6\u5BFC\u5165\u8BBE\u7F6E",export:"\u5BFC\u51FA",import:"\u5BFC\u5165",settingsExported:"\u8BBE\u7F6E\u5DF2\u5BFC\u51FA",settingsImported:"\u8BBE\u7F6E\u5DF2\u5BFC\u5165",invalidSettingsFile:"\u65E0\u6548\u7684\u8BBE\u7F6E\u6587\u4EF6",importSettingsWarning:"\u5BFC\u5165\u5C06\u8986\u76D6\u5F53\u524D\u6240\u6709ExMemo Tools\u7684\u8BBE\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F",confirmationRequired:"\u9700\u8981\u786E\u8BA4",cards:"\u5361\u7247",zettelkastenOptions:"\u5362\u66FC\u5361\u7247\u8BBE\u7F6E",zettelkastenPosition:"\u63D2\u5165\u4F4D\u7F6E",zettelkastenPositionDesc:"\u9009\u62E9\u5362\u66FC\u5361\u7247\u5185\u5BB9\u63D2\u5165\u7684\u4F4D\u7F6E",documentTop:"\u6587\u6863\u9876\u90E8",documentBottom:"\u6587\u6863\u5E95\u90E8",zettelkastenPrompt:"\u5362\u66FC\u5361\u7247\u63D0\u793A\u8BCD",zettelkastenPromptDesc:"\u7528\u4E8E\u751F\u6210\u5362\u66FC\u5361\u7247\u5185\u5BB9\u7684\u63D0\u793A\u8BCD\u3002\u7CFB\u7EDF\u5C06\u6839\u636E\u5F53\u524D\u6587\u6863\u5185\u5BB9\u751F\u6210\u5362\u66FC\u7B14\u8BB0\u3002",exmemoCreateZettelkasten:"\u751F\u6210\u5362\u66FC\u5361\u7247",errorExtractingZettelkasten:"\u63D0\u53D6\u5362\u66FC\u5361\u7247\u65F6\u51FA\u9519",noActiveEditor:"\u6CA1\u6709\u6D3B\u52A8\u7F16\u8F91\u5668",batchZettelkastenComplete:"\u6279\u91CF\u751F\u6210\u5362\u66FC\u5361\u7247\u5B8C\u6210\u3002\u6210\u529F\u5904\u7406 {successCount} \u4E2A\u6587\u4EF6\uFF0C\u5931\u8D25 {failCount} \u4E2A\u6587\u4EF6\u3002",zettelkastenCreated:"\u5362\u66FC\u5361\u7247\u5DF2\u521B\u5EFA",insertCardsAt:"\u63D2\u5165\u4F4D\u7F6E",insertCardsAtDesc:"\u9009\u62E9\u63D2\u5165\u5362\u66FC\u5361\u7247\u7684\u4F4D\u7F6E",beforeContent:"\u5728\u5185\u5BB9\u524D",afterContent:"\u5728\u5185\u5BB9\u540E",regenerateExistingCards:"\u91CD\u65B0\u751F\u6210",regenerateExistingCardsDesc:"\u662F\u5426\u91CD\u65B0\u751F\u6210\u5DF2\u5B58\u5728\u7684\u5362\u66FC\u5361\u7247",cardsAlreadyExist:"\u5DF2\u5B58\u5728\u5362\u66FC\u5361\u7247",defaultZettelkastenPrompt:`\u8BF7\u6839\u636E\u4EE5\u4E0B\u7B14\u8BB0\u5185\u5BB9\uFF0C\u751F\u6210\u4E00\u4E2A\u5362\u66FC\u5361\u7247\u5F0F\u7684\u603B\u7ED3\uFF0C\u5305\u62EC\uFF1A
1. \u4E3B\u8981\u6982\u5FF5\u548C\u601D\u60F3
2. \u4E0E\u5176\u4ED6\u6982\u5FF5\u7684\u8054\u7CFB
3. \u53EF\u80FD\u7684\u5E94\u7528\u573A\u666F`};var vr={en:Fs,"zh-cn":vs,zh:vs},Ir=Fr.moment.locale().toLowerCase(),Un=vr[Ir];if(!Un){let s=Ir.split("-")[0];Un=vr[s]}function l(s){return Un&&Un[s]||Fs[s]}var Mr={llmToken:"sk-",llmBaseUrl:"https://api.openai.com/v1",llmModelName:"gpt-4o",llmPrompts:{},llmDialogEdit:!1,tags:[],metaIsTruncate:!0,metaMaxTokens:1e3,metaTruncateMethod:"head_only",metaUpdateMethod:"no-llm",metaDescription:l("defaultSummaryPrompt"),metaTitleEnabled:!0,metaTitlePrompt:l("defaultTitlePrompt"),metaEditTimeEnabled:!0,metaEditTimeFormat:"YYYY-MM-DD HH:mm:ss",selectExcludedFolders:[],metaTagsFieldName:"tags",metaDescriptionFieldName:"description",metaTitleFieldName:"title",metaUpdatedFieldName:"updated",metaCreatedFieldName:"created",metaTagsPrompt:l("defaultTagsPrompt"),customMetadata:[],metaCategoryFieldName:"category",categories:JSON.parse(l("defaultCategories")),metaCategoryPrompt:l("defaultCategoryPrompt"),metaCategoryEnabled:!0,defaultIndexString:"index_",indexExcludeFile:"",indexExcludeDir:"",metaCoverEnabled:!1,metaCoverFieldName:"cover",metaCoverUrl:"",metaCoverUseFirst:!1,llmResultMode:"unknown",insertCardsAt:"before",regenerateExistingCards:!1,zettelkastenPrompt:l("defaultZettelkastenPrompt"),indexFileDirectory:""};var E=require("obsidian");var ie=require("obsidian");function Is(s,e,t){var o,c;let n=s[e],r=s[t],i=(o=n.priority)!=null?o:Number.MAX_SAFE_INTEGER,a=(c=r.priority)!=null?c:Number.MAX_SAFE_INTEGER;return a!==i?i-a:r.count!==n.count?r.count-n.count:r.lastAccess-n.lastAccess}async function Ms(s,e,t=0){let n=s.settings.llmPrompts,r=Date.now();return n[e]?(n[e].count+=1,n[e].lastAccess=r):n[e]={count:t,lastAccess:r,priority:null},s.settings.llmPrompts=n,await s.saveSettings(),n[e]}async function ta(s){return s.settings.llmPrompts={},await s.saveSettings(),s.settings.llmPrompts}var jn=class extends ie.Modal{constructor(t,n){super(t);this.draggedItem=null;this.plugin=n,this.prompts=n.settings.llmPrompts||{}}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h3",{text:l("promptManager")}),new ie.Setting(t).addButton(r=>r.setButtonText(l("addPrompt")).setCta().onClick(()=>this.showAddPromptDialog())).addButton(r=>r.setButtonText(l("clearPrompts")).setWarning().onClick(()=>this.showClearPromptsConfirmation()));let n=t.createEl("div",{cls:"prompts-container"});this.renderPromptList(n)}renderPromptList(t){if(!t)return;t.empty(),Object.entries(this.prompts).sort(([r],[i])=>Is(this.prompts,r,i)).forEach(([r,i])=>{let a=t.createEl("div",{cls:"prompt-item",attr:{draggable:"true"}});a.addEventListener("dragstart",p=>{this.draggedItem=a,a.addClass("dragging")}),a.addEventListener("dragend",async()=>{a.removeClass("dragging"),await this.updatePriorities(),this.draggedItem=null}),a.addEventListener("dragover",p=>{if(p.preventDefault(),this.draggedItem&&this.draggedItem!==a){let m=a.getBoundingClientRect(),d=(m.top+m.bottom)/2;p.clientY<d?a.before(this.draggedItem):a.after(this.draggedItem)}}),new ie.Setting(a).setName(r).setDesc(`${l("useCount")}: ${i.count}`).addButton(p=>p.setIcon("pencil").onClick(()=>this.showEditPromptDialog(r))).addButton(p=>p.setIcon("trash").onClick(()=>this.deletePrompt(r))).nameEl.addClass("prompt-name-ellipsis");let u=a.querySelector(".setting-item");u instanceof HTMLElement&&u.addClass("prompt-setting-flex")})}async updatePriorities(){let t=this.contentEl.querySelector(".prompts-container"),n=t==null?void 0:t.querySelectorAll(".prompt-item");if(!n||!this.draggedItem)return;let r=-1;n.forEach((i,a)=>{i===this.draggedItem&&(r=a)}),r!==-1&&(n.forEach((i,a)=>{var c;let o=(c=i.querySelector(".setting-item-name"))==null?void 0:c.textContent;o&&this.prompts[o]&&(a<=r||"priority"in this.prompts[o]&&this.prompts[o].priority!==null)&&(this.prompts[o].priority=a)}),await this.savePrompts())}async showAddPromptDialog(){let t=new ie.Modal(this.app);t.titleEl.setText(l("addNewPrompt"));let n=t.contentEl.createEl("textarea");n.placeholder=l("enterPrompt"),n.style.width="100%",n.style.height="100px",new ie.Setting(t.contentEl).addButton(r=>r.setButtonText(l("save")).setCta().onClick(async()=>{let i=n.value.trim();i&&(await Ms(this.plugin,i),this.prompts=this.plugin.settings.llmPrompts,this.renderPromptList(this.contentEl.querySelector(".prompts-container")),t.close())})),t.open()}async showEditPromptDialog(t){let n=new ie.Modal(this.app);n.titleEl.setText(l("editPrompt"));let r=n.contentEl.createEl("textarea");r.value=t,r.style.width="100%",r.style.height="200px",new ie.Setting(n.contentEl).addButton(i=>i.setButtonText(l("resetPrompt")).onClick(()=>{r.value=t})).addButton(i=>i.setButtonText(l("save")).setCta().onClick(async()=>{let a=r.value.trim();a&&a!==t&&(this.prompts[a]=this.prompts[t],delete this.prompts[t],await this.savePrompts(),this.renderPromptList(this.contentEl.querySelector(".prompts-container")),n.close())})),n.open()}async showClearPromptsConfirmation(){let t=new ie.Modal(this.app);t.titleEl.setText(l("clearPromptsConfirmation")),t.contentEl.createEl("p").setText(l("clearPromptsWarning")),new ie.Setting(t.contentEl).addButton(r=>r.setButtonText(l("cancel")).onClick(()=>{t.close()})).addButton(r=>r.setButtonText(l("clear")).setWarning().onClick(async()=>{await ta(this.plugin),this.prompts=this.plugin.settings.llmPrompts,this.renderPromptList(this.contentEl.querySelector(".prompts-container")),t.close()})),t.open()}async deletePrompt(t){delete this.prompts[t],await this.savePrompts(),this.renderPromptList(this.contentEl.querySelector(".prompts-container"))}async savePrompts(){this.prompts=Object.fromEntries(Object.entries(this.prompts).sort(([t,n],[r,i])=>{var c,u;let a=(c=n.priority)!=null?c:Number.MAX_SAFE_INTEGER,o=(u=i.priority)!=null?u:Number.MAX_SAFE_INTEGER;return a!==o?a-o:n.count!==i.count?i.count-n.count:i.lastAccess-n.lastAccess})),this.plugin.settings.llmPrompts=this.prompts,await this.plugin.saveSettings()}onClose(){let{contentEl:t}=this;t.empty()}};var Me=require("obsidian");var $n=require("obsidian");var Vn="RFC3986",Wn={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},Rr="RFC1738";var na=Array.isArray,ue=(()=>{let s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();var Rs=1024,kr=(s,e,t,n,r)=>{if(s.length===0)return s;let i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Rs){let c=i.length>=Rs?i.slice(o,o+Rs):i,u=[];for(let p=0;p<c.length;++p){let m=c.charCodeAt(p);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||r===Rr&&(m===40||m===41)){u[u.length]=c.charAt(p);continue}if(m<128){u[u.length]=ue[m];continue}if(m<2048){u[u.length]=ue[192|m>>6]+ue[128|m&63];continue}if(m<55296||m>=57344){u[u.length]=ue[224|m>>12]+ue[128|m>>6&63]+ue[128|m&63];continue}p+=1,m=65536+((m&1023)<<10|c.charCodeAt(p)&1023),u[u.length]=ue[240|m>>18]+ue[128|m>>12&63]+ue[128|m>>6&63]+ue[128|m&63]}a+=u.join("")}return a};function Dr(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function ks(s,e){if(na(s)){let t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}var sa=Object.prototype.hasOwnProperty,Nr={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},de=Array.isArray,ra=Array.prototype.push,Or=function(s,e){ra.apply(s,de(e)?e:[e])},ia=Date.prototype.toISOString,j={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:kr,encodeValuesOnly:!1,format:Vn,formatter:Wn[Vn],indices:!1,serializeDate(s){return ia.call(s)},skipNulls:!1,strictNullHandling:!1};function aa(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}var Ds={};function $r(s,e,t,n,r,i,a,o,c,u,p,m,d,f,h,g,x,T){let w=s,P=T,I=0,C=!1;for(;(P=P.get(Ds))!==void 0&&!C;){let k=P.get(s);if(I+=1,typeof k!="undefined"){if(k===I)throw new RangeError("Cyclic object value");C=!0}typeof P.get(Ds)=="undefined"&&(I=0)}if(typeof u=="function"?w=u(e,w):w instanceof Date?w=d==null?void 0:d(w):t==="comma"&&de(w)&&(w=ks(w,function(k){return k instanceof Date?d==null?void 0:d(k):k})),w===null){if(i)return c&&!g?c(e,j.encoder,x,"key",f):e;w=""}if(aa(w)||Dr(w)){if(c){let k=g?e:c(e,j.encoder,x,"key",f);return[(h==null?void 0:h(k))+"="+(h==null?void 0:h(c(w,j.encoder,x,"value",f)))]}return[(h==null?void 0:h(e))+"="+(h==null?void 0:h(String(w)))]}let v=[];if(typeof w=="undefined")return v;let R;if(t==="comma"&&de(w))g&&c&&(w=ks(w,c)),R=[{value:w.length>0?w.join(",")||null:void 0}];else if(de(u))R=u;else{let k=Object.keys(w);R=p?k.sort(p):k}let D=o?String(e).replace(/\./g,"%2E"):String(e),M=n&&de(w)&&w.length===1?D+"[]":D;if(r&&de(w)&&w.length===0)return M+"[]";for(let k=0;k<R.length;++k){let $=R[k],N=typeof $=="object"&&typeof $.value!="undefined"?$.value:w[$];if(a&&N===null)continue;let se=m&&o?$.replace(/\./g,"%2E"):$,Ee=de(w)?typeof t=="function"?t(M,se):M:M+(m?"."+se:"["+se+"]");T.set(s,I);let K=new WeakMap;K.set(Ds,T),Or(v,$r(N,Ee,t,n,r,i,a,o,t==="comma"&&g&&de(w)?null:c,u,p,m,d,f,h,g,x,K))}return v}function oa(s=j){if(typeof s.allowEmptyArrays!="undefined"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys!="undefined"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder!="undefined"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=s.charset||j.charset;if(typeof s.charset!="undefined"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Vn;if(typeof s.format!="undefined"){if(!sa.call(Wn,s.format))throw new TypeError("Unknown format option provided.");t=s.format}let n=Wn[t],r=j.filter;(typeof s.filter=="function"||de(s.filter))&&(r=s.filter);let i;if(s.arrayFormat&&s.arrayFormat in Nr?i=s.arrayFormat:"indices"in s?i=s.indices?"indices":"repeat":i=j.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof s.allowDots=="undefined"?s.encodeDotInKeys?!0:j.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:j.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:j.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:j.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter=="undefined"?j.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:j.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:j.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:j.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:j.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:j.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:j.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:j.strictNullHandling}}function Ns(s,e={}){let t=s,n=oa(e),r,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):de(n.filter)&&(i=n.filter,r=i);let a=[];if(typeof t!="object"||t===null)return"";let o=Nr[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);let u=new WeakMap;for(let d=0;d<r.length;++d){let f=r[d];n.skipNulls&&t[f]===null||Or(a,$r(t[f],f,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}let p=a.join(n.delimiter),m=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),p.length>0?m+p:""}var tt="4.104.0";var Lr=!1,nt,Os,ca,ua,da,$s,ma,qn,Ls,Bs,Us,Hn,js;function Br(s,e={auto:!1}){if(Lr)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(nt)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${nt}'\``);Lr=e.auto,nt=s.kind,Os=s.fetch,ca=s.Request,ua=s.Response,da=s.Headers,$s=s.FormData,ma=s.Blob,qn=s.File,Ls=s.ReadableStream,Bs=s.getMultipartRequestOptions,Us=s.getDefaultAgent,Hn=s.fileFromPath,js=s.isFsReadStream}var Jn=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Ur({manuallyImported:s}={}){let e=s?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,n,r,i;try{t=fetch,n=Request,r=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:r,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Jn(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}var Vs=()=>{nt||Br(Ur(),{auto:!0})};Vs();var b=class extends Error{},V=class s extends b{constructor(e,t,n,r){super(`${s.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"],this.error=t;let i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){let r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new De({message:n,cause:zn(t)});let i=t==null?void 0:t.error;return e===400?new fn(e,i,n,r):e===401?new pn(e,i,n,r):e===403?new hn(e,i,n,r):e===404?new gn(e,i,n,r):e===409?new yn(e,i,n,r):e===422?new xn(e,i,n,r):e===429?new wn(e,i,n,r):e>=500?new bn(e,i,n,r):new s(e,i,n,r)}},U=class extends V{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},De=class extends V{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Ne=class extends De{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},fn=class extends V{},pn=class extends V{},hn=class extends V{},gn=class extends V{},yn=class extends V{},xn=class extends V{},wn=class extends V{},bn=class extends V{},vt=class extends b{constructor(){super("Could not parse response content as the length limit was reached")}},It=class extends b{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Gn=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},st=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Z,rt=class{constructor(){Z.set(this,void 0),this.buffer=new Uint8Array,Gn(this,Z,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;let r=[],i;for(;(i=ha(this.buffer,st(this,Z,"f")))!=null;){if(i.carriage&&st(this,Z,"f")==null){Gn(this,Z,i.index,"f");continue}if(st(this,Z,"f")!=null&&(i.index!==st(this,Z,"f")+1||i.carriage)){r.push(this.decodeText(this.buffer.slice(0,st(this,Z,"f")-1))),this.buffer=this.buffer.slice(st(this,Z,"f")),Gn(this,Z,null,"f");continue}let a=st(this,Z,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));r.push(o),this.buffer=this.buffer.slice(i.index),Gn(this,Z,null,"f")}return r}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new b(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new b(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new b("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};Z=new WeakMap;rt.NEWLINE_CHARS=new Set([`
`,"\r"]);rt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ha(s,e){for(let r=e!=null?e:0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function jr(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}function Ws(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var me=class s{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of ga(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(o&&o.error)throw new V(void 0,o.error,void 0,Hs(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(a.event=="error")throw new V(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new s(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){let a=new rt,o=Ws(e);for await(let c of o)for(let u of a.decode(c))yield u;for(let c of a.flush())yield c}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let o of r())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new s(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),r=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new s(()=>r(e),this.controller),new s(()=>r(t),this.controller)]}toReadableStream(){let e=this,t,n=new TextEncoder;return new Ls({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:i,done:a}=await t.next();if(a)return r.close();let o=n.encode(JSON.stringify(i)+`
`);r.enqueue(o)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}};async function*ga(s,e){if(!s.body)throw e.abort(),new b("Attempted to iterate over a response with no body");let t=new qs,n=new rt,r=Ws(s.body);for await(let i of ya(r))for(let a of n.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of n.flush()){let a=t.decode(i);a&&(yield a)}}async function*ya(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let i;for(;(i=jr(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var qs=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=xa(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}};function xa(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}var Vr=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",Wr=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&_n(s),_n=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",wa=s=>Wr(s)||Vr(s)||js(s);async function Gs(s,e,t){var r,i,a;if(s=await s,Wr(s))return s;if(Vr(s)){let o=await s.blob();e||(e=(r=new URL(s.url).pathname.split(/[\\/]/).pop())!=null?r:"unknown_file");let c=_n(o)?[await o.arrayBuffer()]:[o];return new qn(c,e,t)}let n=await ba(s);if(e||(e=(i=Ea(s))!=null?i:"unknown_file"),!(t!=null&&t.type)){let o=(a=n[0])==null?void 0:a.type;typeof o=="string"&&(t={...t,type:o})}return new qn(n,e,t)}async function ba(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(_n(s))e.push(await s.arrayBuffer());else if(Ca(s))for await(let n of s)e.push(n);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${_a(s)}`);return e}function _a(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function Ea(s){var e;return Js(s.name)||Js(s.filename)||((e=Js(s.path))==null?void 0:e.split(/[\\/]/).pop())}var Js=s=>{if(typeof s=="string")return s;if(typeof Buffer!="undefined"&&s instanceof Buffer)return String(s)},Ca=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Xs=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody";var z=async s=>{let e=await qr(s.body);return Bs(e,s)},qr=async s=>{let e=new $s;return await Promise.all(Object.entries(s||{}).map(([t,n])=>zs(e,t,n))),e};var zs=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(wa(t)){let n=await Gs(t);s.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>zs(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>zs(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Aa=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Sa=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Xn;Vs();async function Xr(s){var a;let{response:e}=s;if(s.options.stream)return Ce("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):me.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;let t=e.headers.get("content-type"),n=(a=t==null?void 0:t.split(";")[0])==null?void 0:a.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){let o=await e.json();return Ce("response",e.status,e.url,e.headers,o),Kr(o,e)}let i=await e.text();return Ce("response",e.status,e.url,e.headers,i),i}function Kr(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Yn=class s extends Promise{constructor(e,t=Xr){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new s(this.responsePromise,async t=>Kr(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Qn=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:i}){this.baseURL=e,this.maxRetries=Ks("maxRetries",t),this.timeout=Ks("timeout",n),this.httpAgent=r,this.fetch=i!=null?i:Os}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Ia(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Da()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async r=>{let i=r&&_n(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:t,...r,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g,x,T,w,P,I;let n={...e},{method:r,path:i,query:a,headers:o={}}=n,c=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Xs(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,u=this.calculateContentLength(c),p=this.buildURL(i,a);"timeout"in n&&Ks("timeout",n.timeout),n.timeout=(g=n.timeout)!=null?g:this.timeout;let m=(T=(x=n.httpAgent)!=null?x:this.httpAgent)!=null?T:Us(p),d=n.timeout+1e3;typeof((w=m==null?void 0:m.options)==null?void 0:w.timeout)=="number"&&d>((P=m.options.timeout)!=null?P:0)&&(m.options.timeout=d),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:n,headers:o,contentLength:u,retryCount:t});return{req:{method:r,...c&&{body:c},headers:f,...m&&{agent:m},signal:(I=n.signal)!=null?I:null},url:p,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){let i={};n&&(i["content-length"]=n);let a=this.defaultHeaders(e);return zr(i,a),zr(i,t),Xs(e.body)&&nt!=="node"&&delete i["content-type"],Zn(a,"x-stainless-retry-count")===void 0&&Zn(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(r)),Zn(a,"x-stainless-timeout")===void 0&&Zn(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return V.generate(e,t,n,r)}request(e,t=null){return new Yn(this.makeRequest(e,t))}async makeRequest(e,t){var m,d,f;let n=await e,r=(m=n.maxRetries)!=null?m:this.maxRetries;t==null&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(i,{url:a,options:n}),Ce("request",a,n,i.headers),(d=n.signal)!=null&&d.aborted)throw new U;let c=new AbortController,u=await this.fetchWithTimeout(a,i,o,c).catch(zn);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new U;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new Ne:new De({cause:u})}let p=Hs(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){let P=`retrying, ${t} attempts remaining`;return Ce(`response (error; ${P})`,u.status,a,p),this.retryRequest(n,t,p)}let h=await u.text().catch(P=>zn(P).message),g=Ma(h),x=g?void 0:h;throw Ce(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,a,p,x),this.makeStatusError(u.status,g,x,p)}return{response:u,options:n,controller:c}}requestAPIList(e,t){let n=this.makeRequest(t,null);return new Zs(this,n,e)}buildURL(e,t){let n=ka(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return Zr(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new b(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),n),c={signal:r.signal,...a};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){var o;let r,i=n==null?void 0:n["retry-after-ms"];if(i){let c=parseFloat(i);Number.isNaN(c)||(r=c)}let a=n==null?void 0:n["retry-after"];if(a&&!r){let c=parseFloat(a);Number.isNaN(c)?r=Date.parse(a)-Date.now():r=c*1e3}if(!(r&&0<=r&&r<60*1e3)){let c=(o=e.maxRetries)!=null?o:this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Pe(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${tt}`}},En=class{constructor(e,t,n,r){Xn.set(this,void 0),Aa(this,Xn,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new b("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[r,i]of n)e.url.searchParams.set(r,i);t.query=void 0,t.path=e.url.toString()}return await Sa(this,Xn,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Xn=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Zs=class extends Yn{constructor(e,t,n){super(t,async r=>new n(e,r.response,await Xr(r),r.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Hs=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){let n=t.toString();return e[n.toLowerCase()]||e[n]}}),Ta={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},S=s=>typeof s=="object"&&s!==null&&!Zr(s)&&Object.keys(s).every(e=>Yr(Ta,e)),Fa=()=>{var e,t;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":Jr(Deno.build.os),"X-Stainless-Arch":Hr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)==null?void 0:e.deno)!=null?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":Jr(process.platform),"X-Stainless-Arch":Hr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let s=va();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function va(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let n=t.exec(navigator.userAgent);if(n){let r=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${r}.${i}.${a}`}}}return null}var Hr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Jr=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Kn,Ia=()=>Kn!=null?Kn:Kn=Fa(),Ma=s=>{try{return JSON.parse(s)}catch(e){return}},Ra=/^[a-z][a-z0-9+.-]*:/i,ka=s=>Ra.test(s),Pe=s=>new Promise(e=>setTimeout(e,s)),Ks=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new b(`${s} must be an integer`);if(e<0)throw new b(`${s} must be a positive integer`);return e},zn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch(e){}return new Error(s)};var Cn=s=>{var e,t,n,r,i,a;if(typeof process!="undefined")return(n=(t=(e=process.env)==null?void 0:e[s])==null?void 0:t.trim())!=null?n:void 0;if(typeof Deno!="undefined")return(a=(i=(r=Deno.env)==null?void 0:r.get)==null?void 0:i.call(r,s))==null?void 0:a.trim()};function Zr(s){if(!s)return!0;for(let e in s)return!1;return!0}function Yr(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function zr(s,e){for(let t in e){if(!Yr(e,t))continue;let n=t.toLowerCase();if(!n)continue;let r=e[t];r===null?delete s[n]:r!==void 0&&(s[n]=r)}}var Gr=new Set(["authorization","api-key"]);function Ce(s,...e){var t;if(typeof process!="undefined"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){let n=e.map(r=>{if(!r)return r;if(r.headers){let a={...r,headers:{...r.headers}};for(let o in r.headers)Gr.has(o.toLowerCase())&&(a.headers[o]="REDACTED");return a}let i=null;for(let a in r)Gr.has(a.toLowerCase())&&(i!=null||(i={...r}),i[a]="REDACTED");return i!=null?i:r});console.log(`OpenAI:DEBUG:${s}`,...n)}}var Da=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),Qr=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",Na=s=>typeof(s==null?void 0:s.get)=="function";var Zn=(s,e)=>{var n;let t=e.toLowerCase();if(Na(s)){let r=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(let i of[e,t,e.toUpperCase(),r]){let a=s.get(i);if(a)return a}}for(let[r,i]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};var ei=s=>{if(typeof Buffer!="undefined"){let e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};function Pn(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}var fe=class extends En{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},F=class extends En{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;let e=this.getPaginatedItems();if(!e.length)return null;let t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}};var y=class{constructor(e){this._client=e}};var Mt=class extends y{list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,es,{query:t,...n})}};var Oe=class extends y{constructor(){super(...arguments),this.messages=new Mt(this._client)}create(e,t){var n;return this._client.post("/chat/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/chat/completions",$e,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},$e=class extends F{},es=class extends F{};Oe.ChatCompletionsPage=$e;Oe.Messages=Mt;var Se=class extends y{constructor(){super(...arguments),this.completions=new Oe(this._client)}};Se.Completions=Oe;Se.ChatCompletionsPage=$e;var Rt=class extends y{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}};var kt=class extends y{create(e,t){var n;return this._client.post("/audio/transcriptions",z({body:e,...t,stream:(n=e.stream)!=null?n:!1,__metadata:{model:e.model}}))}};var Dt=class extends y{create(e,t){return this._client.post("/audio/translations",z({body:e,...t,__metadata:{model:e.model}}))}};var pe=class extends y{constructor(){super(...arguments),this.transcriptions=new kt(this._client),this.translations=new Dt(this._client),this.speech=new Rt(this._client)}};pe.Transcriptions=kt;pe.Translations=Dt;pe.Speech=Rt;var Le=class extends y{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/batches",it,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},it=class extends F{};Le.BatchesPage=it;var ae=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},B=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Ys,ts,ns,An,Sn,ss,Tn,Te,Fn,rs,is,Nt,ti,Be=class{constructor(){Ys.add(this),this.controller=new AbortController,ts.set(this,void 0),ns.set(this,()=>{}),An.set(this,()=>{}),Sn.set(this,void 0),ss.set(this,()=>{}),Tn.set(this,()=>{}),Te.set(this,{}),Fn.set(this,!1),rs.set(this,!1),is.set(this,!1),Nt.set(this,!1),ae(this,ts,new Promise((e,t)=>{ae(this,ns,e,"f"),ae(this,An,t,"f")}),"f"),ae(this,Sn,new Promise((e,t)=>{ae(this,ss,e,"f"),ae(this,Tn,t,"f")}),"f"),B(this,ts,"f").catch(()=>{}),B(this,Sn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},B(this,Ys,"m",ti).bind(this))},0)}_connected(){this.ended||(B(this,ns,"f").call(this),this._emit("connect"))}get ended(){return B(this,Fn,"f")}get errored(){return B(this,rs,"f")}get aborted(){return B(this,is,"f")}abort(){this.controller.abort()}on(e,t){return(B(this,Te,"f")[e]||(B(this,Te,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=B(this,Te,"f")[e];if(!n)return this;let r=n.findIndex(i=>i.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(B(this,Te,"f")[e]||(B(this,Te,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{ae(this,Nt,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){ae(this,Nt,!0,"f"),await B(this,Sn,"f")}_emit(e,...t){if(B(this,Fn,"f"))return;e==="end"&&(ae(this,Fn,!0,"f"),B(this,ss,"f").call(this));let n=B(this,Te,"f")[e];if(n&&(B(this,Te,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){let r=t[0];!B(this,Nt,"f")&&!(n!=null&&n.length)&&Promise.reject(r),B(this,An,"f").call(this,r),B(this,Tn,"f").call(this,r),this._emit("end");return}if(e==="error"){let r=t[0];!B(this,Nt,"f")&&!(n!=null&&n.length)&&Promise.reject(r),B(this,An,"f").call(this,r),B(this,Tn,"f").call(this,r),this._emit("end")}}_emitFinal(){}};ts=new WeakMap,ns=new WeakMap,An=new WeakMap,Sn=new WeakMap,ss=new WeakMap,Tn=new WeakMap,Te=new WeakMap,Fn=new WeakMap,rs=new WeakMap,is=new WeakMap,Nt=new WeakMap,Ys=new WeakSet,ti=function(e){if(ae(this,rs,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new U),e instanceof U)return ae(this,is,!0,"f"),this._emit("abort",e);if(e instanceof b)return this._emit("error",e);if(e instanceof Error){let t=new b(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new b(String(e)))};var _=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Y=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},H,Qs,he,as,oe,ot,Ot,at,cs,Q,os,ls,Mn,vn,In,ni,si,ri,ii,ai,oi,li,ge=class s extends Be{constructor(){super(...arguments),H.add(this),Qs.set(this,[]),he.set(this,{}),as.set(this,{}),oe.set(this,void 0),ot.set(this,void 0),Ot.set(this,void 0),at.set(this,void 0),cs.set(this,void 0),Q.set(this,void 0),os.set(this,void 0),ls.set(this,void 0),Mn.set(this,void 0)}[(Qs=new WeakMap,he=new WeakMap,as=new WeakMap,oe=new WeakMap,ot=new WeakMap,Ot=new WeakMap,at=new WeakMap,cs=new WeakMap,Q=new WeakMap,os=new WeakMap,ls=new WeakMap,Mn=new WeakMap,H=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(let r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new s;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;let n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=me.fromReadableStream(e,this.controller);for await(let a of r)_(this,H,"m",vn).call(this,a);if((i=r.controller.signal)!=null&&i.aborted)throw new U;return this._addRun(_(this,H,"m",In).call(this))}toReadableStream(){return new me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,i){let a=new s;return a._run(()=>a._runToolAssistantStream(e,t,n,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r,i){var u;let a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},c=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(let p of c)_(this,H,"m",vn).call(this,p);if((u=c.controller.signal)!=null&&u.aborted)throw new U;return this._addRun(_(this,H,"m",In).call(this))}static createThreadAssistantStream(e,t,n){let r=new s;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){let i=new s;return i._run(()=>i._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return _(this,os,"f")}currentRun(){return _(this,ls,"f")}currentMessageSnapshot(){return _(this,oe,"f")}currentRunStepSnapshot(){return _(this,Mn,"f")}async finalRunSteps(){return await this.done(),Object.values(_(this,he,"f"))}async finalMessages(){return await this.done(),Object.values(_(this,as,"f"))}async finalRun(){if(await this.done(),!_(this,ot,"f"))throw Error("Final run was not received.");return _(this,ot,"f")}async _createThreadAssistantStream(e,t,n){var o;let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let c of a)_(this,H,"m",vn).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new U;return this._addRun(_(this,H,"m",In).call(this))}async _createAssistantStream(e,t,n,r){var c;let i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...r,signal:this.controller.signal});this._connected();for await(let u of o)_(this,H,"m",vn).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new U;return this._addRun(_(this,H,"m",In).call(this))}static accumulateDelta(e,t){for(let[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let i=e[n];if(i==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof i=="string"&&typeof r=="string")i+=r;else if(typeof i=="number"&&typeof r=="number")i+=r;else if(Pn(i)&&Pn(r))i=this.accumulateDelta(i,r);else if(Array.isArray(i)&&Array.isArray(r)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...r);continue}for(let a of r){if(!Pn(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let c=i[o];c==null?i.push(a):i[o]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,i){return await this._createToolAssistantStream(n,e,t,r,i)}};vn=function(e){if(!this.ended)switch(Y(this,os,e,"f"),_(this,H,"m",ri).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":_(this,H,"m",li).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":_(this,H,"m",si).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":_(this,H,"m",ni).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},In=function(){if(this.ended)throw new b("stream has ended, this shouldn't happen");if(!_(this,ot,"f"))throw Error("Final run has not been received");return _(this,ot,"f")},ni=function(e){let[t,n]=_(this,H,"m",ai).call(this,e,_(this,oe,"f"));Y(this,oe,t,"f"),_(this,as,"f")[t.id]=t;for(let r of n){let i=t.content[r.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if(r.type=="text"&&r.text){let i=r.text,a=t.content[r.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=_(this,Ot,"f")){if(_(this,at,"f"))switch(_(this,at,"f").type){case"text":this._emit("textDone",_(this,at,"f").text,_(this,oe,"f"));break;case"image_file":this._emit("imageFileDone",_(this,at,"f").image_file,_(this,oe,"f"));break}Y(this,Ot,r.index,"f")}Y(this,at,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(_(this,Ot,"f")!==void 0){let r=e.data.content[_(this,Ot,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,_(this,oe,"f"));break;case"text":this._emit("textDone",r.text,_(this,oe,"f"));break}}_(this,oe,"f")&&this._emit("messageDone",e.data),Y(this,oe,void 0,"f")}},si=function(e){let t=_(this,H,"m",ii).call(this,e);switch(Y(this,Mn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==_(this,cs,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(_(this,Q,"f")&&this._emit("toolCallDone",_(this,Q,"f")),Y(this,cs,i.index,"f"),Y(this,Q,t.step_details.tool_calls[i.index],"f"),_(this,Q,"f")&&this._emit("toolCallCreated",_(this,Q,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Y(this,Mn,void 0,"f"),e.data.step_details.type=="tool_calls"&&_(this,Q,"f")&&(this._emit("toolCallDone",_(this,Q,"f")),Y(this,Q,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},ri=function(e){_(this,Qs,"f").push(e),this._emit("event",e)},ii=function(e){switch(e.event){case"thread.run.step.created":return _(this,he,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=_(this,he,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let r=ge.accumulateDelta(t,n.delta);_(this,he,"f")[e.data.id]=r}return _(this,he,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":_(this,he,"f")[e.data.id]=e.data;break}if(_(this,he,"f")[e.data.id])return _(this,he,"f")[e.data.id];throw new Error("No snapshot available")},ai=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let i of r.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=_(this,H,"m",oi).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},oi=function(e,t){return ge.accumulateDelta(t,e)},li=function(e){switch(Y(this,ls,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Y(this,ot,e.data,"f"),_(this,Q,"f")&&(this._emit("toolCallDone",_(this,Q,"f")),Y(this,Q,void 0,"f"));break;case"thread.run.cancelling":break}};var lt=class extends y{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/assistants",$t,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},$t=class extends F{};lt.AssistantsPage=$t;function er(s){return typeof s.parse=="function"}var Ue=s=>(s==null?void 0:s.role)==="assistant",tr=s=>(s==null?void 0:s.role)==="function",nr=s=>(s==null?void 0:s.role)==="tool";function Rn(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function ct(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function ci(s,e){return!e||!sr(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:kn(s,e)}function kn(s,e){let t=s.choices.map(n=>{var r,i;if(n.finish_reason==="length")throw new vt;if(n.finish_reason==="content_filter")throw new It;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:(i=(r=n.message.tool_calls)==null?void 0:r.map(a=>Wa(e,a)))!=null?i:void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Va(e,n.message.content):null}}});return{...s,choices:t}}function Va(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function Wa(s,e){var n;let t=(n=s.tools)==null?void 0:n.find(r=>{var i;return((i=r.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:ct(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ui(s,e){var n;if(!s)return!1;let t=(n=s.tools)==null?void 0:n.find(r=>{var i;return((i=r.function)==null?void 0:i.name)===e.function.name});return ct(t)||(t==null?void 0:t.function.strict)||!1}function sr(s){var e,t;return Rn(s.response_format)?!0:(t=(e=s.tools)==null?void 0:e.some(n=>ct(n)||n.type==="function"&&n.function.strict===!0))!=null?t:!1}function di(s){for(let e of s!=null?s:[]){if(e.type!=="function")throw new b(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new b(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var G=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},J,rr,us,ir,ar,or,fi,lr,mi=10,Lt=class extends Be{constructor(){super(...arguments),J.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(tr(e)||nr(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ue(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ue(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new b("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),G(this,J,"m",rr).call(this)}async finalMessage(){return await this.done(),G(this,J,"m",us).call(this)}async finalFunctionCall(){return await this.done(),G(this,J,"m",ir).call(this)}async finalFunctionCallResult(){return await this.done(),G(this,J,"m",ar).call(this)}async totalUsage(){return await this.done(),G(this,J,"m",or).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=G(this,J,"m",us).call(this);t&&this._emit("finalMessage",t);let n=G(this,J,"m",rr).call(this);n&&this._emit("finalContent",n);let r=G(this,J,"m",ir).call(this);r&&this._emit("finalFunctionCall",r);let i=G(this,J,"m",ar).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",G(this,J,"m",or).call(this))}async _createChatCompletion(e,t,n){let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),G(this,J,"m",fi).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(kn(i,t))}async _runChatCompletion(e,t,n){for(let r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var d;let r="function",{function_call:i="auto",stream:a,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:u=mi}=n||{},p={};for(let f of t.functions)p[f.name||f.function.name]=f;let m=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<u;++f){let g=(d=(await this._createChatCompletion(e,{...o,function_call:i,functions:m,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!g)throw new b("missing message in ChatCompletion response");if(!g.function_call)return;let{name:x,arguments:T}=g.function_call,w=p[x];if(w){if(c&&c!==x){let v=`Invalid function_call: ${JSON.stringify(x)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,name:x,content:v});continue}}else{let v=`Invalid function_call: ${JSON.stringify(x)}. Available options are: ${m.map(R=>JSON.stringify(R.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:x,content:v});continue}let P;try{P=er(w)?await w.parse(T):T}catch(v){this._addMessage({role:r,name:x,content:v instanceof Error?v.message:String(v)});continue}let I=await w.function(P,this),C=G(this,J,"m",lr).call(this,I);if(this._addMessage({role:r,name:x,content:C}),c)return}}async _runTools(e,t,n){var f,h,g;let r="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:u=mi}=n||{},p=t.tools.map(x=>{if(ct(x)){if(!x.$callback)throw new b("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:x.$callback,name:x.function.name,description:x.function.description||"",parameters:x.function.parameters,parse:x.$parseRaw,strict:!0}}}return x}),m={};for(let x of p)x.type==="function"&&(m[x.function.name||x.function.function.name]=x.function);let d="tools"in t?p.map(x=>x.type==="function"?{type:"function",function:{name:x.function.name||x.function.function.name,parameters:x.function.parameters,description:x.function.description,strict:x.function.strict}}:x):void 0;for(let x of t.messages)this._addMessage(x,!1);for(let x=0;x<u;++x){let w=(h=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!w)throw new b("missing message in ChatCompletion response");if(!((g=w.tool_calls)!=null&&g.length))return;for(let P of w.tool_calls){if(P.type!=="function")continue;let I=P.id,{name:C,arguments:v}=P.function,R=m[C];if(R){if(c&&c!==C){let $=`Invalid tool_call: ${JSON.stringify(C)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,tool_call_id:I,content:$});continue}}else{let $=`Invalid tool_call: ${JSON.stringify(C)}. Available options are: ${Object.keys(m).map(N=>JSON.stringify(N)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:I,content:$});continue}let D;try{D=er(R)?await R.parse(v):v}catch($){let N=$ instanceof Error?$.message:String($);this._addMessage({role:r,tool_call_id:I,content:N});continue}let M=await R.function(D,this),k=G(this,J,"m",lr).call(this,M);if(this._addMessage({role:r,tool_call_id:I,content:k}),c)return}}}};J=new WeakSet,rr=function(){var e;return(e=G(this,J,"m",us).call(this).content)!=null?e:null},us=function(){var t,n;let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if(Ue(r)){let{function_call:i,...a}=r,o={...a,content:(t=r.content)!=null?t:null,refusal:(n=r.refusal)!=null?n:null};return i&&(o.function_call=i),o}}throw new b("stream ended without producing a ChatCompletionMessage with role=assistant")},ir=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){let r=this.messages[n];if(Ue(r)&&(r!=null&&r.function_call))return r.function_call;if(Ue(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},ar=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(tr(t)&&t.content!=null||nr(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},or=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},fi=function(e){if(e.n!=null&&e.n>1)throw new b("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},lr=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Dn=class s extends Lt{static runFunctions(e,t,n){let r=new s,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){let r=new s,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}_addMessage(e,t=!0){super._addMessage(e,t),Ue(e)&&e.content&&this._emit("content",e.content)}};var q={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},cr=class extends Error{},ur=class extends Error{};function qa(s,e=q.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ha(s.trim(),e)}var Ha=(s,e)=>{let t=s.length,n=0,r=d=>{throw new cr(`${d} at position ${n}`)},i=d=>{throw new ur(`${d} at position ${n}`)},a=()=>(m(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?c():s[n]==="["?u():s.substring(n,n+4)==="null"||q.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||q.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||q.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||q.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||q.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||q.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):p()),o=()=>{let d=n,f=!1;for(n++;n<t&&(s[n]!=='"'||f&&s[n-1]==="\\");)f=s[n]==="\\"?!f:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(d,++n-Number(f)))}catch(h){i(String(h))}else if(q.STR&e)try{return JSON.parse(s.substring(d,n-Number(f))+'"')}catch(h){return JSON.parse(s.substring(d,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},c=()=>{n++,m();let d={};try{for(;s[n]!=="}";){if(m(),n>=t&&q.OBJ&e)return d;let f=o();m(),n++;try{let h=a();Object.defineProperty(d,f,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(q.OBJ&e)return d;throw h}m(),s[n]===","&&n++}}catch(f){if(q.OBJ&e)return d;r("Expected '}' at end of object")}return n++,d},u=()=>{n++;let d=[];try{for(;s[n]!=="]";)d.push(a()),m(),s[n]===","&&n++}catch(f){if(q.ARR&e)return d;r("Expected ']' at end of array")}return n++,d},p=()=>{if(n===0){s==="-"&&q.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(f){if(q.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(h){}i(String(f))}}let d=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(q.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(d,n))}catch(f){s.substring(d,n)==="-"&&q.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(d,s.lastIndexOf("e")))}catch(h){i(String(h))}}},m=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return a()},dr=s=>qa(s,q.ALL^q.NUM);var Bt=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},O=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},W,Fe,Ut,je,mr,ds,fr,pr,hr,ms,gr,pi,jt=class s extends Lt{constructor(e){super(),W.add(this),Fe.set(this,void 0),Ut.set(this,void 0),je.set(this,void 0),Bt(this,Fe,e,"f"),Bt(this,Ut,[],"f")}get currentChatCompletionSnapshot(){return O(this,je,"f")}static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let r=new s(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var a;super._createChatCompletion;let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),O(this,W,"m",mr).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let o of i)O(this,W,"m",fr).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new U;return this._addChatCompletion(O(this,W,"m",ms).call(this))}async _fromReadableStream(e,t){var a;let n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),O(this,W,"m",mr).call(this),this._connected();let r=me.fromReadableStream(e,this.controller),i;for await(let o of r)i&&i!==o.id&&this._addChatCompletion(O(this,W,"m",ms).call(this)),O(this,W,"m",fr).call(this,o),i=o.id;if((a=r.controller.signal)!=null&&a.aborted)throw new U;return this._addChatCompletion(O(this,W,"m",ms).call(this))}[(Fe=new WeakMap,Ut=new WeakMap,je=new WeakMap,W=new WeakSet,mr=function(){this.ended||Bt(this,je,void 0,"f")},ds=function(t){let n=O(this,Ut,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},O(this,Ut,"f")[t.index]=n,n)},fr=function(t){var r,i,a,o,c,u,p,m,d,f,h,g,x,T,w,P,I,C,v,R;if(this.ended)return;let n=O(this,W,"m",pi).call(this,t);this._emit("chunk",t,n);for(let D of t.choices){let M=n.choices[D.index];D.delta.content!=null&&((r=M.message)==null?void 0:r.role)==="assistant"&&((i=M.message)!=null&&i.content)&&(this._emit("content",D.delta.content,M.message.content),this._emit("content.delta",{delta:D.delta.content,snapshot:M.message.content,parsed:M.message.parsed})),D.delta.refusal!=null&&((a=M.message)==null?void 0:a.role)==="assistant"&&((o=M.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:D.delta.refusal,snapshot:M.message.refusal}),((c=D.logprobs)==null?void 0:c.content)!=null&&((u=M.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(p=D.logprobs)==null?void 0:p.content,snapshot:(d=(m=M.logprobs)==null?void 0:m.content)!=null?d:[]}),((f=D.logprobs)==null?void 0:f.refusal)!=null&&((h=M.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=D.logprobs)==null?void 0:g.refusal,snapshot:(T=(x=M.logprobs)==null?void 0:x.refusal)!=null?T:[]});let k=O(this,W,"m",ds).call(this,M);M.finish_reason&&(O(this,W,"m",hr).call(this,M),k.current_tool_call_index!=null&&O(this,W,"m",pr).call(this,M,k.current_tool_call_index));for(let $ of(w=D.delta.tool_calls)!=null?w:[])k.current_tool_call_index!==$.index&&(O(this,W,"m",hr).call(this,M),k.current_tool_call_index!=null&&O(this,W,"m",pr).call(this,M,k.current_tool_call_index)),k.current_tool_call_index=$.index;for(let $ of(P=D.delta.tool_calls)!=null?P:[]){let N=(I=M.message.tool_calls)==null?void 0:I[$.index];N!=null&&N.type&&((N==null?void 0:N.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(C=N.function)==null?void 0:C.name,index:$.index,arguments:N.function.arguments,parsed_arguments:N.function.parsed_arguments,arguments_delta:(R=(v=$.function)==null?void 0:v.arguments)!=null?R:""}):(N==null||N.type,void 0))}}},pr=function(t,n){var a,o,c;if(O(this,W,"m",ds).call(this,t).done_tool_calls.has(n))return;let i=(a=t.message.tool_calls)==null?void 0:a[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let u=(c=(o=O(this,Fe,"f"))==null?void 0:o.tools)==null?void 0:c.find(p=>p.type==="function"&&p.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:ct(u)?u.$parseRaw(i.function.arguments):u!=null&&u.function.strict?JSON.parse(i.function.arguments):null})}else i.type},hr=function(t){var r,i;let n=O(this,W,"m",ds).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let a=O(this,W,"m",gr).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ms=function(){if(this.ended)throw new b("stream has ended, this shouldn't happen");let t=O(this,je,"f");if(!t)throw new b("request ended without sending any chunks");return Bt(this,je,void 0,"f"),Bt(this,Ut,[],"f"),Ja(t,O(this,Fe,"f"))},gr=function(){var n;let t=(n=O(this,Fe,"f"))==null?void 0:n.response_format;return Rn(t)?t:null},pi=function(t){var p,m,d,f,h,g;var n,r,i,a;let o=O(this,je,"f"),{choices:c,...u}=t;o?Object.assign(o,u):o=Bt(this,je,{...u,choices:[]},"f");for(let{delta:x,finish_reason:T,index:w,logprobs:P=null,...I}of t.choices){let C=o.choices[w];if(C||(C=o.choices[w]={finish_reason:T,index:w,message:{},logprobs:P,...I}),P)if(!C.logprobs)C.logprobs=Object.assign({},P);else{let{content:N,refusal:se,...Ee}=P;Object.assign(C.logprobs,Ee),N&&((p=(n=C.logprobs).content)!=null||(n.content=[]),C.logprobs.content.push(...N)),se&&((m=(r=C.logprobs).refusal)!=null||(r.refusal=[]),C.logprobs.refusal.push(...se))}if(T&&(C.finish_reason=T,O(this,Fe,"f")&&sr(O(this,Fe,"f")))){if(T==="length")throw new vt;if(T==="content_filter")throw new It}if(Object.assign(C,I),!x)continue;let{content:v,refusal:R,function_call:D,role:M,tool_calls:k,...$}=x;if(Object.assign(C.message,$),R&&(C.message.refusal=(C.message.refusal||"")+R),M&&(C.message.role=M),D&&(C.message.function_call?(D.name&&(C.message.function_call.name=D.name),D.arguments&&((d=(i=C.message.function_call).arguments)!=null||(i.arguments=""),C.message.function_call.arguments+=D.arguments)):C.message.function_call=D),v&&(C.message.content=(C.message.content||"")+v,!C.message.refusal&&O(this,W,"m",gr).call(this)&&(C.message.parsed=dr(C.message.content))),k){C.message.tool_calls||(C.message.tool_calls=[]);for(let{index:N,id:se,type:Ee,function:K,...Gi}of k){let ce=(f=(a=C.message.tool_calls)[N])!=null?f:a[N]={};Object.assign(ce,Gi),se&&(ce.id=se),Ee&&(ce.type=Ee),K&&((g=ce.function)!=null||(ce.function={name:(h=K.name)!=null?h:"",arguments:""})),K!=null&&K.name&&(ce.function.name=K.name),K!=null&&K.arguments&&(ce.function.arguments+=K.arguments,ui(O(this,Fe,"f"),ce)&&(ce.function.parsed_arguments=dr(ce.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(let r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Ja(s,e){let{id:t,choices:n,created:r,model:i,system_fingerprint:a,...o}=s,c={...o,id:t,choices:n.map(({message:u,finish_reason:p,index:m,logprobs:d,...f})=>{var P,I,C;if(!p)throw new b(`missing finish_reason for choice ${m}`);let{content:h=null,function_call:g,tool_calls:x,...T}=u,w=u.role;if(!w)throw new b(`missing role for choice ${m}`);if(g){let{arguments:v,name:R}=g;if(v==null)throw new b(`missing function_call.arguments for choice ${m}`);if(!R)throw new b(`missing function_call.name for choice ${m}`);return{...f,message:{content:h,function_call:{arguments:v,name:R},role:w,refusal:(P=u.refusal)!=null?P:null},finish_reason:p,index:m,logprobs:d}}return x?{...f,index:m,finish_reason:p,logprobs:d,message:{...T,role:w,content:h,refusal:(I=u.refusal)!=null?I:null,tool_calls:x.map((v,R)=>{let{function:D,type:M,id:k,...$}=v,{arguments:N,name:se,...Ee}=D||{};if(k==null)throw new b(`missing choices[${m}].tool_calls[${R}].id
${fs(s)}`);if(M==null)throw new b(`missing choices[${m}].tool_calls[${R}].type
${fs(s)}`);if(se==null)throw new b(`missing choices[${m}].tool_calls[${R}].function.name
${fs(s)}`);if(N==null)throw new b(`missing choices[${m}].tool_calls[${R}].function.arguments
${fs(s)}`);return{...$,id:k,type:M,function:{...Ee,name:se,arguments:N}}})}}:{...f,message:{...T,content:h,role:w,refusal:(C=u.refusal)!=null?C:null},finish_reason:p,index:m,logprobs:d}}),created:r,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return ci(c,e)}function fs(s){return JSON.stringify(s)}var Nn=class s extends jt{static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){let r=new s(null),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,i)),r}static runTools(e,t,n){let r=new s(t),i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,i)),r}};var On=class extends y{parse(e,t){return di(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>kn(n,e))}runFunctions(e,t){return e.stream?Nn.runFunctions(this._client,e,t):Dn.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Nn.runTools(this._client,e,t):Dn.runTools(this._client,e,t)}stream(e,t){return jt.createChatCompletion(this._client,e,t)}};var Vt=class extends y{constructor(){super(...arguments),this.completions=new On(this._client)}};(function(s){s.Completions=On})(Vt||(Vt={}));var Wt=class extends y{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var qt=class extends y{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var Ve=class extends y{constructor(){super(...arguments),this.sessions=new Wt(this._client),this.transcriptionSessions=new qt(this._client)}};Ve.Sessions=Wt;Ve.TranscriptionSessions=qt;var ut=class extends y{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ht,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},Ht=class extends F{};ut.MessagesPage=Ht;var dt=class extends y{retrieve(e,t,n,r={},i){return S(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,n={},r){return S(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Jt,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Jt=class extends F{};dt.RunStepsPage=Jt;var ve=class extends y{constructor(){super(...arguments),this.steps=new dt(this._client)}create(e,t,n){var a;let{include:r,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:(a=t.stream)!=null?a:!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,zt,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return ge.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await Pe(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ge.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){var i;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(i=n.stream)!=null?i:!1})}async submitToolOutputsAndPoll(e,t,n,r){let i=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,i.id,r)}submitToolOutputsStream(e,t,n,r){return ge.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}},zt=class extends F{};ve.RunsPage=zt;ve.Steps=dt;ve.RunStepsPage=Jt;var ye=class extends y{constructor(){super(...arguments),this.runs=new ve(this._client),this.messages=new ut(this._client)}create(e={},t){return S(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){var n;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:(n=e.stream)!=null?n:!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return ge.createThreadAssistantStream(e,this._client.beta.threads,t)}};ye.Runs=ve;ye.RunsPage=zt;ye.Messages=ut;ye.MessagesPage=Ht;var le=class extends y{constructor(){super(...arguments),this.realtime=new Ve(this._client),this.chat=new Vt(this._client),this.assistants=new lt(this._client),this.threads=new ye(this._client)}};le.Realtime=Ve;le.Assistants=lt;le.AssistantsPage=$t;le.Threads=ye;var mt=class extends y{create(e,t){var n;return this._client.post("/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}};var Gt=class extends y{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}};var We=class extends y{constructor(){super(...arguments),this.content=new Gt(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,z({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Xt,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}},Xt=class extends F{};We.FileListResponsesPage=Xt;We.Content=Gt;var xe=class extends y{constructor(){super(...arguments),this.files=new We(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/containers",ft,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}},ft=class extends F{};xe.ContainerListResponsesPage=ft;xe.Files=We;xe.FileListResponsesPage=Xt;var pt=class extends y{create(e,t){let n=!!e.encoding_format,r=n?e.encoding_format:"base64";n&&Ce("Request","User defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?i:(Ce("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let c=o.embedding;o.embedding=ei(c)}),a)))}};var ht=class extends y{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return S(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Kt,{query:n,...r})}},Kt=class extends F{};ht.OutputItemListResponsesPage=Kt;var Ie=class extends y{constructor(){super(...arguments),this.outputItems=new ht(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Zt,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}},Zt=class extends F{};Ie.RunListResponsesPage=Zt;Ie.OutputItems=ht;Ie.OutputItemListResponsesPage=Kt;var we=class extends y{constructor(){super(...arguments),this.runs=new Ie(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/evals",gt,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},gt=class extends F{};we.EvalListResponsesPage=gt;we.Runs=Ie;we.RunListResponsesPage=Zt;var qe=class extends y{create(e,t){return this._client.post("/files",z({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/files",yt,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){let r=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await Pe(t),a=await this.retrieve(e),Date.now()-i>n)throw new Ne({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},yt=class extends F{};qe.FileObjectsPage=yt;var Yt=class extends y{};var Qt=class extends y{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var xt=class extends y{constructor(){super(...arguments),this.graders=new Qt(this._client)}};xt.Graders=Qt;var wt=class extends y{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,en,{body:t,method:"post",...n})}retrieve(e,t={},n){return S(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}},en=class extends fe{};wt.PermissionCreateResponsesPage=en;var He=class extends y{constructor(){super(...arguments),this.permissions=new wt(this._client)}};He.Permissions=wt;He.PermissionCreateResponsesPage=en;var bt=class extends y{list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,tn,{query:t,...n})}},tn=class extends F{};bt.FineTuningJobCheckpointsPage=tn;var be=class extends y{constructor(){super(...arguments),this.checkpoints=new bt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",nn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return S(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,sn,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},nn=class extends F{},sn=class extends F{};be.FineTuningJobsPage=nn;be.FineTuningJobEventsPage=sn;be.Checkpoints=bt;be.FineTuningJobCheckpointsPage=tn;var ee=class extends y{constructor(){super(...arguments),this.methods=new Yt(this._client),this.jobs=new be(this._client),this.checkpoints=new He(this._client),this.alpha=new xt(this._client)}};ee.Methods=Yt;ee.Jobs=be;ee.FineTuningJobsPage=nn;ee.FineTuningJobEventsPage=sn;ee.Checkpoints=He;ee.Alpha=xt;var rn=class extends y{};var Je=class extends y{constructor(){super(...arguments),this.graderModels=new rn(this._client)}};Je.GraderModels=rn;var _t=class extends y{createVariation(e,t){return this._client.post("/images/variations",z({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",z({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var ze=class extends y{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Et,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Et=class extends fe{};ze.ModelsPage=Et;var Ct=class extends y{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function hi(s,e){return!e||!go(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:yr(s,e)}function yr(s,e){let t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:wo(e,r)};if(r.type==="message"){let i=r.content.map(a=>a.type==="output_text"?{...a,parsed:ho(e,a.text)}:a);return{...r,content:i}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||xr(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let r of n.output)if(r.type==="message"){for(let i of r.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function ho(s,e){var t,n,r,i;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((i=s.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function go(s){var e;return!!Rn((e=s.text)==null?void 0:e.format)}function yo(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function xo(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function wo(s,e){var n;let t=xo((n=s.tools)!=null?n:[],e.name);return{...e,...e,parsed_arguments:yo(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function xr(s){let e=[];for(let t of s.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var an=class extends y{list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,ps,{query:t,...n})}};var on=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Ge=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},ln,hs,Xe,gs,gi,yi,xi,wi,ys=class s extends Be{constructor(e){super(),ln.add(this),hs.set(this,void 0),Xe.set(this,void 0),gs.set(this,void 0),on(this,hs,e,"f")}static createResponse(e,t,n){let r=new s(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o,c;let r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ge(this,ln,"m",gi).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=(o=t.starting_after)!=null?o:null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let u of i)Ge(this,ln,"m",yi).call(this,u,a);if((c=i.controller.signal)!=null&&c.aborted)throw new U;return Ge(this,ln,"m",xi).call(this)}[(hs=new WeakMap,Xe=new WeakMap,gs=new WeakMap,ln=new WeakSet,gi=function(){this.ended||on(this,Xe,void 0,"f")},yi=function(t,n){if(this.ended)return;let r=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},i=Ge(this,ln,"m",wi).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new b(`missing output at index ${t.output_index}`);if(a.type==="message"){let o=a.content[t.content_index];if(!o)throw new b(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new b(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new b(`missing output at index ${t.output_index}`);a.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:r(t.type,t);break}},xi=function(){if(this.ended)throw new b("stream has ended, this shouldn't happen");let t=Ge(this,Xe,"f");if(!t)throw new b("request ended without sending any events");on(this,Xe,void 0,"f");let n=_o(t,Ge(this,hs,"f"));return on(this,gs,n,"f"),n},wi=function(t){let n=Ge(this,Xe,"f");if(!n){if(t.type!=="response.created")throw new b(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=on(this,Xe,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let r=n.output[t.output_index];if(!r)throw new b(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{let r=n.output[t.output_index];if(!r)throw new b(`missing output at index ${t.output_index}`);if(r.type==="message"){let i=r.content[t.content_index];if(!i)throw new b(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new b(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let r=n.output[t.output_index];if(!r)throw new b(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{on(this,Xe,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(let r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(let i of t)i.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=Ge(this,gs,"f");if(!e)throw new b("stream ended without producing a ChatCompletion");return e}};function _o(s,e){return hi(s,e)}var Ke=class extends y{constructor(){super(...arguments),this.inputItems=new an(this._client)}create(e,t){var n;return this._client.post("/responses",{body:e,...t,stream:(n=e.stream)!=null?n:!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&xr(r),r))}retrieve(e,t={},n){var r;return this._client.get(`/responses/${e}`,{query:t,...n,stream:(r=t==null?void 0:t.stream)!=null?r:!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>yr(n,e))}stream(e,t){return ys.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}},ps=class extends F{};Ke.InputItems=an;var cn=class extends y{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,z({body:t,...n}))}};var Ze=class extends y{constructor(){super(...arguments),this.parts=new cn(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}};Ze.Parts=cn;var bi=async s=>{let e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(let r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let r of e)r.status==="fulfilled"&&n.push(r.value);return n};var Ye=class extends y{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return S(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Qe,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){let r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){let r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let i=await this.retrieve(e,t,{...n,headers:r}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{let c=i.response.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await Pe(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){let r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){let r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,un,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},Qe=class extends F{},un=class extends fe{};Ye.VectorStoreFilesPage=Qe;Ye.FileContentResponsesPage=un;var dn=class extends y{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){let r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return S(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Qe,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,t,n){let r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await Pe(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){var d;if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=(d=r==null?void 0:r.maxConcurrency)!=null?d:5,a=Math.min(i,t.length),o=this._client,c=t.values(),u=[...n];async function p(f){for(let h of f){let g=await o.files.create({file:h,purpose:"assistants"},r);u.push(g.id)}}let m=Array(a).fill(c).map(p);return await bi(m),await this.createAndPoll(e,{file_ids:u})}};var te=class extends y{constructor(){super(...arguments),this.files=new Ye(this._client),this.fileBatches=new dn(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return S(e)?this.list({},e):this._client.getAPIList("/vector_stores",Pt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,At,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},Pt=class extends F{},At=class extends fe{};te.VectorStoresPage=Pt;te.VectorStoreSearchResponsesPage=At;te.Files=Ye;te.VectorStoreFilesPage=Qe;te.FileContentResponsesPage=un;te.FileBatches=dn;var _i,A=class extends Qn{constructor({baseURL:e=Cn("OPENAI_BASE_URL"),apiKey:t=Cn("OPENAI_API_KEY"),organization:n=(a=>(a=Cn("OPENAI_ORG_ID"))!=null?a:null)(),project:r=(o=>(o=Cn("OPENAI_PROJECT_ID"))!=null?o:null)(),...i}={}){var u;if(t===void 0)throw new b("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let c={apiKey:t,organization:n,project:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&Qr())throw new b(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(u=c.timeout)!=null?u:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new mt(this),this.chat=new Se(this),this.embeddings=new pt(this),this.files=new qe(this),this.images=new _t(this),this.audio=new pe(this),this.moderations=new Ct(this),this.models=new ze(this),this.fineTuning=new ee(this),this.graders=new Je(this),this.vectorStores=new te(this),this.beta=new le(this),this.batches=new Le(this),this.uploads=new Ze(this),this.responses=new Ke(this),this.evals=new we(this),this.containers=new xe(this),this._options=c,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ns(e,{arrayFormat:"brackets"})}};_i=A;A.OpenAI=_i;A.DEFAULT_TIMEOUT=6e5;A.OpenAIError=b;A.APIError=V;A.APIConnectionError=De;A.APIConnectionTimeoutError=Ne;A.APIUserAbortError=U;A.NotFoundError=gn;A.ConflictError=yn;A.RateLimitError=wn;A.BadRequestError=fn;A.AuthenticationError=pn;A.InternalServerError=bn;A.PermissionDeniedError=hn;A.UnprocessableEntityError=xn;A.toFile=Gs;A.fileFromPath=Hn;A.Completions=mt;A.Chat=Se;A.ChatCompletionsPage=$e;A.Embeddings=pt;A.Files=qe;A.FileObjectsPage=yt;A.Images=_t;A.Audio=pe;A.Moderations=Ct;A.Models=ze;A.ModelsPage=Et;A.FineTuning=ee;A.Graders=Je;A.VectorStores=te;A.VectorStoresPage=Pt;A.VectorStoreSearchResponsesPage=At;A.Beta=le;A.Batches=Le;A.BatchesPage=it;A.Uploads=Ze;A.Responses=Ke;A.Evals=we;A.EvalListResponsesPage=gt;A.Containers=xe;A.ContainerListResponsesPage=ft;var Ei=A;async function Ci(s,e){let t="",n=new Ei({apiKey:e.llmToken,baseURL:e.llmBaseUrl,dangerouslyAllowBrowser:!0});try{let r=await n.chat.completions.create({model:e.llmModelName,messages:[{role:"user",content:s}]});r.choices.length>0&&(t=r.choices[0].message.content||t)}catch(r){throw console.warn("Error:",r),r}return t}async function So(s,e){let t="",n=e.llmBaseUrl||"https://generativelanguage.googleapis.com";n.endsWith("/")&&(n=n.substring(0,n.length-1)),n.includes("/v1beta")||(n+="/v1beta"),n+=`/models/${e.llmModelName}:generateContent?key=${e.llmToken}`;let a=await(0,$n.requestUrl)({url:n,method:"POST",headers:{"Content-Type":"application/json"},contentType:"application/json",body:JSON.stringify({contents:[{parts:[{text:s}]}]}),throw:!0});if(a.status>=200&&a.status<300&&a.json){let o=a.json;o.candidates&&o.candidates.length>0&&o.candidates[0].content&&o.candidates[0].content.parts&&(t=o.candidates[0].content.parts[0].text||"")}return t}async function ne(s,e,t=!0){var i;let n="",r=null;t&&(r=new $n.Notice(l("llmLoading"),0));try{if(!((i=e.llmBaseUrl)==null?void 0:i.includes("googleapis.com")))return n=await Ci(s,e),n;try{if(n=await So(s,e),n)return n}catch(o){console.warn("requestUrl failed:",o)}try{if(n=await Ci(s,e),n)return n}catch(o){console.warn("OpenAI SDK failed for Google API:",o)}if(!n)throw new Error("All Google API request methods failed")}catch(a){console.warn("Error in callLLM:",a),t&&new $n.Notice(l("llmError")+`
`+(a instanceof Error?a.message:String(a)))}finally{r&&r.hide()}return n}async function Pi(s){try{if(!s.llmToken)return{success:!1,error:l("apiKeyEmpty")};if(!s.llmModelName)return{success:!1,error:l("modelNameEmpty")};let e=l("connectionTestPrompt");return await ne(e,s,!1)?{success:!0}:{success:!1,error:l("apiResponseEmpty")}}catch(e){return console.error("LLM connection test error:",e),{success:!1,error:e instanceof Error?e.message:String(e)}}}var wr=class extends Me.Modal{constructor(e,t,n,r,i){super(e),this.message=t,this.resolvePromise=n,this.yesText=r||l("yes"),this.noText=i||l("no"),this.resolved=!1}onOpen(){this.titleEl.setText(l("confirm")),this.message.split(`
`).forEach(i=>{i.trim()&&this.contentEl.createEl("p",{text:i})});let t=this.contentEl.createEl("div",{cls:"dialog-button-container"}),n=t.createEl("button",{text:this.yesText});n.onclick=()=>{this.resolved=!0,this.close(),this.resolvePromise(!0)};let r=t.createEl("button",{text:this.noText});r.onclick=()=>{this.resolved=!0,this.close(),this.resolvePromise(!1)}}onClose(){this.resolved||this.resolvePromise(void 0)}};async function et(s,e,t,n){return new Promise(r=>{new wr(s,e,r,t,n).open()})}function St(s){let e=/[\u4e00-\u9fa5]|[a-zA-Z0-9]+|[\.,!?;#]|[\n]/g;return s.match(e)||[]}function mn(s){let e="";for(let t=0;t<s.length;t++){let n=s[t];n===`
`||/[\u4e00-\u9fa5]|[\.,!?;#]/.test(n)?e+=n:e+=(t>0?" ":"")+n}return e.trim()}var Ai=30;async function To(s,e,t){let n=s.join(","),r=St(n).length,i=l("simplifyTagsConfirm").replace("{count}",r.toString());if(!await et(e,i))return null;let o=l("simplifyTagsPrompt").replace("{count}",Ai.toString()),c=await ne(o+`

`+s.join(`
`),t,!0);if(!c)return new Me.Notice(l("llmError")),null;let u=c.trim(),p=u.indexOf("```");if(p!==-1){let f=u.lastIndexOf("```");if(f>p){let g=u.substring(p,f+3).split(`
`);g.length>1&&g[0].startsWith("```")&&g.shift(),g.length>0&&g[g.length-1].includes("```")&&g.pop(),u=g.join(`
`).trim()}}let m=[];try{let f=JSON.parse(u);f&&Array.isArray(f.tags)&&(m=f.tags.filter(h=>typeof h=="string"&&h.trim()))}catch(f){if(console.log("Failed to parse JSON response, falling back to text parsing",f),u.includes('"tags":'))try{let h=u.match(/"tags"\s*:\s*\[([\s\S]*?)\]/);h&&h[1]&&(m=h[1].split(",").map(g=>g.trim().replace(/^["']|["']$/g,"")).filter(Boolean))}catch(h){console.log("Failed advanced text parsing",h)}}m.length===0&&(m=c.split(`
`).map(f=>f.trim()).filter(f=>f.length>0&&!f.startsWith("```")));let d=St(m.join(",")).length;return new Me.Notice(l("tagsSimplified").replace("{count}",m.length.toString()).replace("{tokens}",d.toString())),m}async function Si(s,e){let t={};s.vault.getMarkdownFiles().forEach(r=>{let i=s.metadataCache.getFileCache(r);if(i){let a=(0,Me.getAllTags)(i);a&&a.forEach(o=>{let c=o;c.startsWith("#")&&(c=c.slice(1)),t[c]?t[c]++:t[c]=1})}});let n=Object.keys(t);if(n.length>Ai){let r=await To(n,s,e);if(r){let i={};return r.forEach(a=>{i[a]=t[a]||3}),i}}return t}function xs(s,e,t){let n=new RegExp(`## ${e}[\\s\\S]*?(?=##|$)`);return n.test(s)?s.replace(n,`${t}

`):s.trim()+`

`+t+`
`}function Fo(s,e){let t=new RegExp(`## ${e}[\\s\\S]*?(?=##|$)`),n=s.match(t);return n?n[0].replace(new RegExp(`## ${e}
?`),"").trim():""}function vo(s,e){if(!(e!=null&&e.metaIsTruncate)||s.length===0)return s;let t=St(s);if((e==null?void 0:e.metaMaxTokens)>0&&t.length>e.metaMaxTokens){let n=e.metaTruncateMethod;if(n==="head_tail"){let r=Math.round(e.metaMaxTokens*.8),i=Math.round(e.metaMaxTokens*.2),a=t.slice(0,r),o=t.slice(-i);s=mn(a)+`
...
`+mn(o)}else if(n==="head_only")s=mn(t.slice(0,e.metaMaxTokens))+"...";else if(n==="heading"){let r=s.split(`
`);r=r.filter(c=>c.trim()!=="");let i=[],a=!1;for(let c of r)if(c.startsWith("#"))i.push(c),a=!0;else if(a&&c.trim()!==""){let u=St(c);i.push(mn(u.slice(0,30))+"..."),a=!1}s=i.join(`
`);let o=St(s);if(o.length>e.metaMaxTokens)s=mn(o.slice(0,e.metaMaxTokens));else{let c=e.metaMaxTokens-o.length,u=mn(t.slice(0,c))+"...";s=`Outline: 
${s}

Body: ${u}`}}}return s}async function Ti(s,e,t,n=!1,r=!0){var a;let i="";if(e!==null){if(i=await s.vault.read(e),t&&Tt(e,t)){let o=Fo(i,l("fileDetail"));o&&(i=o)}else if(!n&&i.startsWith("---")){let o=i.indexOf("---",3);o!==-1&&(i=i.substring(o+3).trim())}}else{let o=(a=s.workspace.getActiveViewOfType(Me.MarkdownView))==null?void 0:a.editor;if(!o)return"";if(i=o.getSelection(),i=i.trim(),i.length===0&&(i=o.getValue(),!n&&i.startsWith("---"))){let c=i.indexOf("---",3);c!==-1&&(i=i.substring(c+3).trim())}}return i.length===0?"":r?vo(i,t):i}function X(s,e,t,n,r){e.fileManager.processFrontMatter(s,i=>{if(n!=null)if(r==="append"){let a=i[t];if(typeof n=="string")a==null&&(a=""),i[t]=a+n;else if(Array.isArray(n)){(a==null||!Array.isArray(a))&&(a=[]);let o=a.concat(n),c=Array.from(new Set(o));i[t]=c}}else if(r==="update")i[t]=n;else{let a=i[t];if(a!=null)return;i[t]=n}})}function Tt(s,e){return!!s.basename.startsWith(e.defaultIndexString)}var Fi=s=>{if(s==null)return"";if(typeof s=="string")return s;if(typeof s=="object")try{return JSON.stringify(s,null,2)}catch(e){return String(s)}return String(s)};var ws=class extends E.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.addGeneralSettings(),this.addAssistantSettings(),this.addTruncateSettings(),this.addFolderSettings(),this.addMetadataSettings(),this.addCardSettings(),this.addIndexFileSettings(),this.addImportExportSettings(),this.addDonationSettings()}addGeneralSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("llmSettings")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("llmSettingsDesc")),new E.Setting(t).setName(l("apiKey")).addText(r=>r.setPlaceholder("Enter your token").setValue(this.plugin.settings.llmToken?"\u2022".repeat(Math.min(20,this.plugin.settings.llmToken.length)):"").onChange(async i=>{i.match(/^[]+$/)||(this.plugin.settings.llmToken=i,await this.plugin.saveSettings())})),new E.Setting(t).setName(l("baseUrl")).addText(r=>r.setPlaceholder("https://api.openai.com/v1").setValue(this.plugin.settings.llmBaseUrl).onChange(async i=>{this.plugin.settings.llmBaseUrl=i,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("modelName")).addText(r=>r.setPlaceholder("gpt-4o").setValue(this.plugin.settings.llmModelName).onChange(async i=>{this.plugin.settings.llmModelName=i,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("testLlmConnection")).setDesc(l("testLlmConnectionDesc")).addButton(r=>{r.setButtonText(l("testConnection")).setCta().onClick(async()=>{r.setButtonText(l("testing")),r.setDisabled(!0);try{let i=await Pi(this.plugin.settings);i.success?new E.Notice(l("connectionSuccess")):new E.Notice(l("connectionFailed")+": "+i.error,5e3)}catch(i){new E.Notice(l("connectionError")+": "+i.message,5e3)}finally{r.setButtonText(l("testConnection")),r.setDisabled(!1)}})})}addAssistantSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("llmAssistantSetting")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("llmAssistantSettingDesc")),new E.Setting(t).setName(l("llmAssistantDialogEdit")).setDesc(l("llmAssistantDialogEditDesc")).addToggle(r=>{r.setValue(this.plugin.settings.llmDialogEdit).onChange(async i=>{this.plugin.settings.llmDialogEdit=i,await this.plugin.saveSettings()})}),new E.Setting(t).setName(l("resultMode")).setDesc(l("resultModeDesc")).addDropdown(r=>{r.addOption("unknown",l("askEachTime")).addOption("append",l("appendToSelection")).addOption("prepend",l("prependToSelection")).addOption("replace",l("replaceSelection")).setValue(this.plugin.settings.llmResultMode).onChange(async i=>{this.plugin.settings.llmResultMode=i,await this.plugin.saveSettings()})}),new E.Setting(t).setName(l("managePrompts")).setDesc(l("managePromptsDesc")).addButton(r=>r.setButtonText(l("openPromptManager")).setCta().onClick(()=>{new jn(this.app,this.plugin).open()}))}addFolderSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("folderSelectionSetting")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("folderSelectionSettingDesc")),new E.Setting(t).setName(l("excludedFolders")).setDesc(l("excludedFoldersDesc")).addTextArea(r=>{r.setValue(this.plugin.settings.selectExcludedFolders.join(`
`)).onChange(async i=>{this.plugin.settings.selectExcludedFolders=i.split(`
`).map(a=>a.trim()).filter(a=>a!==""),await this.plugin.saveSettings()}),r.inputEl.setAttr("rows","3"),r.inputEl.addClass("setting-textarea")})}addTruncateSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("truncateSettings")}),new E.Setting(t).setName(l("truncateContent")).setDesc(l("truncateContentDesc")).addToggle(r=>{r.setValue(this.plugin.settings.metaIsTruncate).onChange(async i=>{this.plugin.settings.metaIsTruncate=i,await this.plugin.saveSettings(),n.style.display=i?"block":"none"})});let n=t.createEl("div",{cls:"setting-item-indent2"});new E.Setting(n).setName(l("maxContentLength")).setDesc(l("maxContentLengthDesc")).addText(r=>{r.setValue(this.plugin.settings.metaMaxTokens.toString()).onChange(async i=>{this.plugin.settings.metaMaxTokens=parseInt(i),await this.plugin.saveSettings()})}),new E.Setting(n).setName(l("truncateMethod")).setDesc(l("truncateMethodDesc")).addDropdown(r=>{r.addOption("head_only",l("head_only")).addOption("head_tail",l("head_tail")).addOption("heading",l("heading")).setValue(this.plugin.settings.metaTruncateMethod).onChange(async i=>{this.plugin.settings.metaTruncateMethod=i,await this.plugin.saveSettings()})}),n.style.display=this.plugin.settings.metaIsTruncate?"block":"none"}addMetadataSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse",attr:{id:"meta-settings-collapse"}});t.createEl("summary",{text:l("metaSetting")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("metaSettingDesc")),new E.Setting(t).setName(l("metaUpdateSetting")).setDesc(l("updateMetaOptionsDesc")).setClass("setting-item-indent1").addDropdown(h=>{h.addOption("force",l("updateForce")).addOption("no-llm",l("updateNoLLM")).setValue(this.plugin.settings.metaUpdateMethod).onChange(async g=>{this.plugin.settings.metaUpdateMethod=g,await this.plugin.saveSettings()})});let r=t.createEl("details",{cls:"setting-item-collapse nested-settings"});r.createEl("summary",{text:l("description")}),new E.Setting(r).setName(l("descriptionFieldName")).setDesc(l("descriptionFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaDescriptionFieldName).onChange(async g=>{this.plugin.settings.metaDescriptionFieldName=g||"description",await this.plugin.saveSettings()})),new E.Setting(r).setName(l("descriptionPrompt")).setDesc(l("descriptionPromptDesc")).addTextArea(h=>{h.setValue(this.plugin.settings.metaDescription).onChange(async g=>{this.plugin.settings.metaDescription=g,await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","3"),h.inputEl.addClass("setting-textarea")});let i=t.createEl("details",{cls:"setting-item-collapse nested-settings"});i.createEl("summary",{text:l("taggingOptions")});let a;new E.Setting(i).setName(l("tagsFieldName")).setDesc(l("tagsFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaTagsFieldName).onChange(async g=>{this.plugin.settings.metaTagsFieldName=g||"tags",await this.plugin.saveSettings()})),new E.Setting(i).setName(l("extractTags")).setDesc(l("extractTagsDesc")).addButton(h=>{h.setButtonText(l("extract")).setCta().onClick(async()=>{let g=await Si(this.app,this.plugin.settings),T=Object.entries(g).sort((P,I)=>I[1]-P[1]).filter(([P,I])=>I>2).map(([P])=>P),w=this.plugin.settings.tags;for(let P of T)w.includes(P)||w.push(P);this.plugin.settings.tags=w,a.setValue(this.plugin.settings.tags.join(`
`)),await this.plugin.saveSettings()})}),new E.Setting(i).setName(l("tagList")).setDesc(l("tagListDesc")).addTextArea(h=>{a=h,h.setValue(this.plugin.settings.tags.join(`
`)).onChange(async g=>{this.plugin.settings.tags=g.split(`
`).map(x=>x.trim()).filter(x=>x!==""),await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","7"),h.inputEl.addClass("setting-textarea")}),new E.Setting(i).setName(l("metaTagsPrompt")).setDesc(l("metaTagsPromptDesc")).addTextArea(h=>{h.setPlaceholder(this.plugin.settings.metaTagsPrompt).setValue(this.plugin.settings.metaTagsPrompt).onChange(async g=>{this.plugin.settings.metaTagsPrompt=g,await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","3"),h.inputEl.addClass("setting-textarea")});let o=t.createEl("details",{cls:"setting-item-collapse nested-settings"});o.createEl("summary",{text:l("categoryOptions")}),new E.Setting(o).setName(l("enableCategory")).setDesc(l("enableCategoryDesc")).addToggle(h=>h.setValue(this.plugin.settings.metaCategoryEnabled).onChange(async g=>{this.plugin.settings.metaCategoryEnabled=g,await this.plugin.saveSettings()})),new E.Setting(o).setName(l("categoryFieldName")).setDesc(l("categoryFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaCategoryFieldName).onChange(async g=>{this.plugin.settings.metaCategoryFieldName=g||"category",await this.plugin.saveSettings()})),new E.Setting(o).setName(l("categoryList")).setDesc(l("categoryListDesc")).addTextArea(h=>{h.setValue(this.plugin.settings.categories.join(`
`)).onChange(async g=>{this.plugin.settings.categories=g.split(`
`).map(x=>x.trim()).filter(x=>x!==""),await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","5"),h.inputEl.addClass("setting-textarea")}),new E.Setting(o).setName(l("metaCategoryPrompt")).setDesc(l("metaCategoryPromptDesc")).addTextArea(h=>{h.setPlaceholder(this.plugin.settings.metaCategoryPrompt).setValue(this.plugin.settings.metaCategoryPrompt).onChange(async g=>{this.plugin.settings.metaCategoryPrompt=g,await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","3"),h.inputEl.addClass("setting-textarea")});let c=t.createEl("details",{cls:"setting-item-collapse nested-settings"});c.createEl("summary",{text:l("title")}),new E.Setting(c).setName(l("enableTitle")).setDesc(l("enableTitleDesc")).addToggle(h=>{h.setValue(this.plugin.settings.metaTitleEnabled).onChange(async g=>{this.plugin.settings.metaTitleEnabled=g,await this.plugin.saveSettings(),u.setDisabled(!g)})}),new E.Setting(c).setName(l("titleFieldName")).setDesc(l("titleFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaTitleFieldName).onChange(async g=>{this.plugin.settings.metaTitleFieldName=g||"title",await this.plugin.saveSettings()}));let u=new E.Setting(c).setName(l("titlePrompt")).setDesc(l("titlePromptDesc")).addTextArea(h=>{h.setValue(this.plugin.settings.metaTitlePrompt).onChange(async g=>{this.plugin.settings.metaTitlePrompt=g,await this.plugin.saveSettings()}),h.inputEl.setAttr("rows","3"),h.inputEl.addClass("setting-textarea")});u.setDisabled(!this.plugin.settings.metaTitleEnabled);let p=t.createEl("details",{cls:"setting-item-collapse nested-settings"});p.createEl("summary",{text:l("coverImage")}),new E.Setting(p).setName(l("enableCover")).setDesc(l("enableCoverDesc")).addToggle(h=>h.setValue(this.plugin.settings.metaCoverEnabled).onChange(async g=>{this.plugin.settings.metaCoverEnabled=g,await this.plugin.saveSettings()})),new E.Setting(p).setName(l("coverFieldName")).setDesc(l("coverFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaCoverFieldName).onChange(async g=>{this.plugin.settings.metaCoverFieldName=g||"cover",await this.plugin.saveSettings()})),new E.Setting(p).setName(l("coverUrl")).setDesc(l("coverUrlDesc")).addText(h=>h.setValue(this.plugin.settings.metaCoverUrl).onChange(async g=>{this.plugin.settings.metaCoverUrl=g,await this.plugin.saveSettings()})),new E.Setting(p).setName(l("useFirstImage")).setDesc(l("useFirstImageDesc")).addToggle(h=>h.setValue(this.plugin.settings.metaCoverUseFirst).onChange(async g=>{this.plugin.settings.metaCoverUseFirst=g,await this.plugin.saveSettings()}));let m=t.createEl("details",{cls:"setting-item-collapse nested-settings"});m.createEl("summary",{text:l("editTime")}),new E.Setting(m).setName(l("enableEditTime")).setDesc(l("enableEditTimeDesc")).addToggle(h=>{h.setValue(this.plugin.settings.metaEditTimeEnabled).onChange(async g=>{this.plugin.settings.metaEditTimeEnabled=g,await this.plugin.saveSettings(),d.setDisabled(!g)})}),new E.Setting(m).setName(l("updateTimeFieldName")).setDesc(l("updateTimeFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaUpdatedFieldName).onChange(async g=>{this.plugin.settings.metaUpdatedFieldName=g||"updated",await this.plugin.saveSettings()})),new E.Setting(m).setName(l("createTimeFieldName")).setDesc(l("createTimeFieldNameDesc")).addText(h=>h.setValue(this.plugin.settings.metaCreatedFieldName).onChange(async g=>{this.plugin.settings.metaCreatedFieldName=g||"created",await this.plugin.saveSettings()}));let d=new E.Setting(m).setName(l("editTimeFormat")).setDesc(l("editTimeFormatDesc")).addText(h=>{h.setValue(this.plugin.settings.metaEditTimeFormat).setPlaceholder("YYYY-MM-DD HH:mm:ss").onChange(async g=>{this.plugin.settings.metaEditTimeFormat=g,await this.plugin.saveSettings()})});d.setDisabled(!this.plugin.settings.metaEditTimeEnabled);let f=t.createEl("details",{cls:"setting-item-collapse nested-settings",attr:{id:"custom-meta-collapse"}});f.createEl("summary",{text:l("customMetadata")}),new E.Setting(f).setName(l("metaSetting")).setDesc(l("customMetadataDesc")).setHeading().addButton(h=>h.setButtonText(l("addField")).onClick(async()=>{this.plugin.settings.customMetadata.push({key:"",value:"",type:"static"}),await this.plugin.saveSettings(),this.refresh()})),this.plugin.settings.customMetadata.forEach((h,g)=>{let x=new E.Setting(f);x.addText(T=>T.setPlaceholder(l("fieldKey")).setValue(h.key).onChange(async w=>{this.plugin.settings.customMetadata[g].key=w,await this.plugin.saveSettings()})),x.addDropdown(T=>T.addOption("static",l("staticValue")).addOption("prompt",l("promptValue")).setValue(h.type||"static").onChange(async w=>{this.plugin.settings.customMetadata[g].type=w,await this.plugin.saveSettings()})),x.addText(T=>T.setPlaceholder(h.type==="prompt"?l("fieldPrompt"):l("fieldValue")).setValue(h.value).onChange(async w=>{this.plugin.settings.customMetadata[g].value=w,await this.plugin.saveSettings()})),x.addButton(T=>T.setIcon("trash").onClick(async()=>{this.plugin.settings.customMetadata.splice(g,1),await this.plugin.saveSettings(),this.refresh()}))})}addCardSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("zettelkastenOptions")||"zettelkastenOptions"}),new E.Setting(t).setName(l("zettelkastenPosition")).setDesc(l("zettelkastenPositionDesc")).addDropdown(n=>n.addOption("top",l("documentTop")).addOption("bottom",l("documentBottom")).setValue(this.plugin.settings.zettelkastenPosition||"bottom").onChange(async r=>{this.plugin.settings.hasOwnProperty("zettelkastenPosition")||(this.plugin.settings.zettelkastenPosition="bottom"),this.plugin.settings.zettelkastenPosition=r,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("zettelkastenPrompt")).setDesc(l("zettelkastenPromptDesc")).addTextArea(n=>{n.setPlaceholder(l("defaultZettelkastenPrompt")).setValue(this.plugin.settings.zettelkastenPrompt).onChange(async r=>{this.plugin.settings.hasOwnProperty("zettelkastenPrompt")||(this.plugin.settings.zettelkastenPrompt=""),this.plugin.settings.zettelkastenPrompt=r,await this.plugin.saveSettings()}),n.inputEl.setAttr("rows","5"),n.inputEl.addClass("setting-textarea")}),new E.Setting(t).setName(l("insertCardsAt")).setDesc(l("insertCardsAtDesc")).addDropdown(n=>n.addOption("before",l("beforeContent")).addOption("after",l("afterContent")).setValue(this.plugin.settings.insertCardsAt).onChange(async r=>{this.plugin.settings.insertCardsAt=r,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("regenerateExistingCards")).setDesc(l("regenerateExistingCardsDesc")).addToggle(n=>n.setValue(this.plugin.settings.regenerateExistingCards).onChange(async r=>{this.plugin.settings.regenerateExistingCards=r,await this.plugin.saveSettings()}))}refresh(){let e=document.getElementById("meta-settings-collapse"),t=document.getElementById("custom-meta-collapse"),n=e==null?void 0:e.open,r=t==null?void 0:t.open;this.display(),requestAnimationFrame(()=>{let i=document.getElementById("meta-settings-collapse"),a=document.getElementById("custom-meta-collapse");n&&i&&(i.open=!0),r&&a&&(a.open=!0)})}addIndexFileSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("indexFileSetting")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("indexFileSettingDesc")),new E.Setting(t).setName(l("defaultIndexString")).setDesc(l("defaultIndexStringDesc")).addText(r=>r.setPlaceholder("index_").setValue(this.plugin.settings.defaultIndexString).onChange(async i=>{this.plugin.settings.defaultIndexString=i,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("indexExcludeFile")).setDesc(l("indexExcludeFileDesc")).addText(r=>r.setPlaceholder("xxx.md, *_yyy.md default is null").setValue(this.plugin.settings.indexExcludeFile).onChange(async i=>{this.plugin.settings.indexExcludeFile=i,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("indexExcludeDir")).setDesc(l("indexExcludeDirDesc")).addText(r=>r.setPlaceholder("xxx, *_yyy default is null").setValue(this.plugin.settings.indexExcludeDir).onChange(async i=>{this.plugin.settings.indexExcludeDir=i,await this.plugin.saveSettings()})),new E.Setting(t).setName(l("indexFileDirectory")).setDesc(l("indexFileDirectoryDesc")).addText(r=>r.setPlaceholder("").setValue(this.plugin.settings.indexFileDirectory).onChange(async i=>{this.plugin.settings.indexFileDirectory=i,await this.plugin.saveSettings()}))}addImportExportSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("importExportSettings")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("importExportSettingsDesc")),new E.Setting(t).setName(l("exportSettings")).setDesc(l("exportSettingsDesc")).addButton(r=>{r.setButtonText(l("export")).setCta().onClick(()=>{let i=JSON.stringify(this.plugin.settings,null,2),a=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(a),c=document.createElement("a");c.href=o,c.download=`exmemo_tools_settings_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(o)},0),new E.Notice(l("settingsExported"))})}),new E.Setting(t).setName(l("importSettings")).setDesc(l("importSettingsDesc")).addButton(r=>{r.setButtonText(l("import")).onClick(()=>{let i=document.createElement("input");i.type="file",i.accept="application/json",i.addEventListener("change",a=>{var u;let c=(u=a.target.files)==null?void 0:u[0];if(c){let p=new FileReader;p.onload=async m=>{var d;try{let f=(d=m.target)==null?void 0:d.result,h=JSON.parse(f);await et(this.app,l("importSettingsWarning"))&&(this.plugin.settings=Object.assign({},this.plugin.settings,h),await this.plugin.saveSettings(),this.display(),new E.Notice(l("settingsImported")))}catch(f){console.error(f),new E.Notice(l("invalidSettingsFile"))}},p.readAsText(c)}}),i.click()})})}addDonationSettings(){let t=this.containerEl.createEl("div").createEl("details",{cls:"setting-item-collapse"});t.createEl("summary",{text:l("donate")}),t.createEl("div",{cls:"setting-item-description"}).setText(l("donateDesc")),new E.Setting(t).setName(l("supportThisPlugin")).setDesc(l("supportThisPluginDesc")).addButton(r=>{r.setButtonText(l("bugMeACoffee")).setCta().onClick(()=>{window.open("https://buymeacoffee.com/xieyan0811y","_blank")})})}};var L=require("obsidian");var br=require("obsidian");var vi=require("obsidian");var Ft=class{constructor(e,t,n,r=!0){this.features=new Map;this.results={};this.content="";this.debug=!1;this.extracted=!1;this.truncateContent=!0;this.app=t,this.settings=n,this.truncateContent=r,e instanceof vi.TFile?this.file=e:this.content=e}addFeature(e,t,n=[],r=!0,i=!1){this.features.set(e,{key:e,prompt:t,options:n,required:r,multiple:i,jsonType:i?`"${e}": "value1,value2,value3"`:`"${e}": "value"`})}async buildRequest(){this.file&&!this.content&&(this.content=await Ti(this.app,this.file,this.settings,!1,this.truncateContent));let e=[],t=[],n=1;for(let i of this.features.values()){let a=`${n}. ${i.key}: ${i.prompt}`;if(i.options&&i.options.length>0){let o=i.options.join(",");a+=`
   Available ${i.key}: ${o}`,i.multiple?a+=". Feel free to choose multiple options or create new ones if none are suitable.":a+=". Must choose ONE from the available options."}e.push(a),t.push(i.jsonType||`"${i.key}": "value for ${i.key}"`),n++}let r=`I need to generate metadata for the following article. Requirements:

`+e.join(`

`)+`

Please return in the following JSON format:
{
    ${t.join(`,
    `)}
}

`;return this.file&&(r+=`File path: ${this.file.path}

`),r+=`The article content is as follows:

${this.content}`,r}async extract(e=!1,t=!0){var a;if(this.features.size===0)return!1;let n=e;if(!e&&this.file){let o=((a=this.app.metadataCache.getFileCache(this.file))==null?void 0:a.frontmatter)||{};for(let c of this.features.values())if(c.required&&(!o[c.key]||Array.isArray(o[c.key])&&o[c.key].length===0||typeof o[c.key]=="string"&&o[c.key].trim()==="")){n=!0;break}if(!n)return this.debug&&console.warn(l("alreadyContainsMetadata")),!1}let r=await this.buildRequest(),i=await ne(r,this.settings,t);if(this.debug&&(console.log("LLM request:",r),console.log("LLM response:",i)),!i)return!1;i=i.replace(/`/g,"");try{let o=i.match(/{[^]*}/);if(o){let c=JSON.parse(o[0]);for(let u in c)if(typeof c[u]=="string"){let p=c[u].trim().toLowerCase();p==="true"?c[u]=!0:p==="false"&&(c[u]=!1)}this.results=c;for(let u of this.features.values())u.multiple&&typeof this.results[u.key]=="string"&&(this.results[u.key]=this.results[u.key].split(",").map(p=>p.trim()));return this.extracted=!0,!0}}catch(o){return console.error("Parse error:",o),!1}return!1}getFeature(e){if(!this.extracted){console.warn("Features have not been extracted yet. Call extract() first.");return}return this.results[e]}getAllFeatures(){return this.extracted?{...this.results}:(console.warn("Features have not been extracted yet. Call extract() first."),{})}};async function Ln(s,e,t,n=!1,r=!0,i=!0,a=!1){let o=!1;if(i&&(o=await Mo(s,e,t,n,r,a)),await Ro(s,e,t,n)&&(o=!0),t.metaEditTimeEnabled)try{let u=Ii(new Date,t.metaEditTimeFormat);X(s,e,t.metaUpdatedFieldName,u,"update");let p=new Date(s.stat.ctime),m=Ii(p,"YYYY-MM-DD");X(s,e,t.metaCreatedFieldName,m,"update"),o=!0}catch(c){console.error("Update time failed:",c),new br.Notice(l("llmError")+": "+c)}if(t.customMetadata&&t.customMetadata.length>0){for(let c of t.customMetadata)if(c.key&&c.value&&c.type!=="prompt"){let u=c.value;(c.value.toLowerCase()==="true"||c.value.toLowerCase()==="false")&&(u=c.value.toLowerCase()==="true"),X(s,e,c.key,u,n?"update":"keep")}o=!0}o&&r&&new br.Notice(l("metaUpdated"))}async function Mi(s,e,t,n=!1){let r=new Ft(s,e,t);return Ri(r,s,e,t,n)||n?await r.buildRequest():""}async function Mo(s,e,t,n=!1,r=!0,i=!1){let a=new Ft(s,e,t),o=e.metadataCache.getFileCache(s),c=(o==null?void 0:o.frontmatter)||{};if(!Ri(a,s,e,t,n))return i&&console.warn(l("fileAlreadyContainsTagsAndDescription")),!1;if(!await a.extract(n,r))return!1;let m=a.getAllFeatures();if(m[t.metaTagsFieldName]&&X(s,e,t.metaTagsFieldName,m[t.metaTagsFieldName],"append"),m[t.metaCategoryFieldName]&&t.metaCategoryEnabled){let d=c[t.metaCategoryFieldName],f=!d||d.trim()==="";X(s,e,t.metaCategoryFieldName,m[t.metaCategoryFieldName],n||f?"update":"keep")}if(m[t.metaDescriptionFieldName]){let d=c[t.metaDescriptionFieldName],f=!d||d.trim()==="";X(s,e,t.metaDescriptionFieldName,m[t.metaDescriptionFieldName],n||f?"update":"keep")}if(t.metaTitleEnabled&&m[t.metaTitleFieldName]){let d=m[t.metaTitleFieldName];typeof d=="string"&&(d=d.trim(),(d.startsWith('"')&&d.endsWith('"')||d.startsWith("'")&&d.endsWith("'"))&&(d=d.substring(1,d.length-1)));let f=c[t.metaTitleFieldName],h=!f||f.trim()==="";X(s,e,t.metaTitleFieldName,d,n||h?"update":"keep")}if(t.customMetadata&&t.customMetadata.length>0){for(let d of t.customMetadata)if(d.key&&d.value&&d.type==="prompt"&&m[d.key]!==void 0){let f=m[d.key];typeof f=="string"&&(f=f.trim(),(f.startsWith('"')&&f.endsWith('"')||f.startsWith("'")&&f.endsWith("'"))&&(f=f.substring(1,f.length-1)));let h=c[d.key],g=!h||typeof h=="string"&&h.trim()==="";X(s,e,d.key,f,n||g?"update":"keep")}}return!0}function Ri(s,e,t,n,r=!1){var c,u,p,m;let i=t.metadataCache.getFileCache(e),a=(i==null?void 0:i.frontmatter)||{},o=r;if((!a[n.metaTagsFieldName]||((c=a[n.metaTagsFieldName])==null?void 0:c.length)===0||r)&&(s.addFeature(n.metaTagsFieldName,n.metaTagsPrompt,n.tags,!0,!0),o=!0),n.metaCategoryEnabled&&(!a[n.metaCategoryFieldName]||((u=a[n.metaCategoryFieldName])==null?void 0:u.trim())===""||r)&&(s.addFeature(n.metaCategoryFieldName,n.metaCategoryPrompt,n.categories||[l("categoryUnknown")],!0,!1),o=!0),(!a[n.metaDescriptionFieldName]||((p=a[n.metaDescriptionFieldName])==null?void 0:p.trim())===""||r)&&(s.addFeature(n.metaDescriptionFieldName,n.metaDescription,[],!0,!1),o=!0),n.metaTitleEnabled&&(!a[n.metaTitleFieldName]||((m=a[n.metaTitleFieldName])==null?void 0:m.trim())===""||r)&&(s.addFeature(n.metaTitleFieldName,n.metaTitlePrompt,[],!0,!1),o=!0),n.customMetadata&&n.customMetadata.length>0)for(let d of n.customMetadata)d.key&&d.value&&d.type==="prompt"&&(!a[d.key]||typeof a[d.key]=="string"&&a[d.key].trim()===""||r)&&(s.addFeature(d.key,d.value,[],!0,!1),o=!0);return o}async function Ro(s,e,t,n=!1){if(t.metaCoverEnabled){let r=e.metadataCache.getFileCache(s),a=((r==null?void 0:r.frontmatter)||{})[t.metaCoverFieldName],o=!a||a.trim()==="";if(n||o){let c=t.metaCoverUrl;if(t.metaCoverUseFirst){let p=(await e.vault.read(s)).match(/!\[.*?\]\((.*?)\)/);p&&p[1]&&(c=p[1])}if(c)return X(s,e,t.metaCoverFieldName,c,"update"),!0}}return!1}function Ii(s,e){let t=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0"),i=String(s.getHours()).padStart(2,"0"),a=String(s.getMinutes()).padStart(2,"0"),o=String(s.getSeconds()).padStart(2,"0");return e.replace("YYYY",t.toString()).replace("MM",n).replace("DD",r).replace("HH",i).replace("mm",a).replace("ss",o)}var Re=require("obsidian");var bs=class s{constructor(e=!1,t="",n="",r=""){let i=new Date,a=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0"),u=String(i.getHours()).padStart(2,"0"),p=String(i.getMinutes()).padStart(2,"0"),m=String(i.getSeconds()).padStart(2,"0"),d=String(i.getMilliseconds()).padStart(3,"0"),f=`${a}${o}${c}${u}${p}${m}${d}`,h=e?"1":"0";this.id=`${f}-${h}`,this.title=t,this.content=r,this.isFromSelection=e}format(){let e=this.content.trim().split(`
`).map(t=>t.trim()).map(t=>`> ${t}`).join(`
`);return`> [!zk ${this.id}] ${this.title}
${e}`}static parse(e){let t=/> \[!zk (\d+)-([01])\] (.+)/,n=e.match(t);if(!n)return null;let r=n[1],i=n[2],a=n[3],o=i==="1",c=e.split(`
`),u=[],p=1;for(;p<c.length&&c[p].startsWith(">");)u.push(c[p].replace(/^> /,"")),p++;let m=u.join(`
`),d=new s(o,a,"",m);return d.id=`${r}-${i}`,d}},Bn=class{constructor(e,t,n){this.app=e,this.file=t,this.settings=n}async readExistingCards(){let e=await this.app.vault.read(this.file),t=/> \[!zk \d+-[01]\].+\n(?:>.+\n)+/g,n=e.match(t);if(!n)return[];let r=[];for(let i of n){let a=bs.parse(i);a&&r.push(a)}return r}getFrontmatterEndPosition(e){let t=/^---\n([\s\S]*?)\n---\n/,n=e.match(t);return n?n[0].length:0}removeNonSelectionCards(e){let t=/> \[!zk \d+-[0]\].+\n(?:>.*\n)+/g;return e.replace(t,"")}async writeCards(e){let t=await this.app.vault.read(this.file),n=t;e.some(a=>!a.isFromSelection)&&(n=this.removeNonSelectionCards(t));let i=e.map(a=>a.format()).join(`

`);if(this.settings.insertCardsAt==="before"){let a=this.getFrontmatterEndPosition(n);n=n.slice(0,a)+i+`

`+n.slice(a)}else n=n+`

`+i;n=n.replace(/\n{3,}/g,`

`),await this.app.vault.modify(this.file,n)}async shouldGenerateCards(){if(!this.settings.regenerateExistingCards){let e=await this.readExistingCards();for(let t of e)if(!t.isFromSelection)return!1}return!0}};async function ki(s,e){var n;let t=s.workspace.getActiveFile();if(!t){new Re.Notice(l("pleaseOpenFile"));return}if(t.extension!=="md"){new Re.Notice(l("currentFileNotMarkdown"));return}try{let r=(n=s.workspace.getActiveViewOfType(Re.MarkdownView))==null?void 0:n.editor;if(!r)return new Re.Notice(l("noActiveEditor")),"";let i=r.getSelection(),a=i,o=!1;!i||i.trim()===""?(a=await s.vault.read(t),o=!1):o=!0,await ko(s,a,t,e,!0,o)}catch(r){console.error("Error extracting zettelkasten:",r)}}async function ko(s,e,t,n,r=!0,i=!1){try{let a=new Bn(s,t,n);if(!i&&!await a.shouldGenerateCards()){r&&new Re.Notice(l("cardsAlreadyExist"));return}let o=null;if(!i){let u=s.metadataCache.getFileCache(t);o=((u==null?void 0:u.frontmatter)||{})[n.metaTitleFieldName]}let c=await Do(s,e,o,n,i,r);await a.writeCards([c]),r&&new Re.Notice(l("zettelkastenCreated"))}catch(a){console.error("Error creating zettelkasten:",a),r&&new Re.Notice(l("errorExtractingZettelkasten"))}}async function Do(s,e,t,n,r=!1,i=!0){let a=new bs(r),o=200;try{let c=!r,u=new Ft(e,s,n,c),p="Please extract one card, return plain text",m=n.zettelkastenPrompt||l("defaultZettelkastenPrompt");if(t||u.addFeature("title",n.metaTitlePrompt,[],!0,!1),u.addFeature("content",p+": "+m,[],!0,!1),await u.extract(!0,i)){let f=u.getAllFeatures();a.title=f.title||t,a.content=Fi(f.content)||e.substring(0,o)}else a.content=e.substring(0,o)}catch(c){console.error("Error processing content with LLM:",c),a.content=e.substring(0,o)}return a}function No(s){let e=s.replace(/[.+^${}()|[\]\\]/g,"\\$&");return e=e.replace(/\*/g,".*"),new RegExp(e)}function _s(s,e){if(!e)return!1;let t=e.split(",").map(n=>n.trim()).filter(n=>n!=="");for(let n of t)if(No(n).test(s.path))return!0;return!1}var Es=class extends L.Notice{constructor(t){super("",0);this.cancelled=!1;this._messageEl=document.createElement("div"),setTimeout(()=>{let n=this.noticeEl;if(n){n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.gap="8px",n.style.padding="8px",this._messageEl.textContent=t,this._messageEl.style.textAlign="center",n.appendChild(this._messageEl);let r=document.createElement("button");r.textContent=l("cancel"),r.style.minWidth="60px",r.style.padding="4px 8px",r.addEventListener("click",()=>{this.cancelled=!0,this.hide()}),n.appendChild(r)}},0)}updateMessage(t){this._messageEl.textContent=t}};function _r(s,e,t=!0){var r,i,a;let n=e.metadataCache.getFileCache(s);return!!(!t&&((r=n==null?void 0:n.frontmatter)!=null&&r.description)||t&&((i=n==null?void 0:n.frontmatter)!=null&&i.tags)&&((a=n==null?void 0:n.frontmatter)!=null&&a.description))}async function Di(s,e,t=10){var n;for(let r=0;r<t;r++){let i=s.metadataCache.getFileCache(e);if((n=i==null?void 0:i.frontmatter)!=null&&n.description)return;await new Promise(a=>setTimeout(a,100))}}async function Er(s,e,t,n=!0){let r=s.path,i=s.name,a=`${r}/${t.defaultIndexString}${i}.md`,o=e.vault.getAbstractFileByPath(a);if(!o||!(o instanceof L.TFile)){if(!n)return null;if(await e.vault.create(a,""),o=e.vault.getAbstractFileByPath(a),!o||!(o instanceof L.TFile))return console.log("failed to create file"),null}return o}async function Ni(s,e,t,n){let r=s.filter(a=>{let o=_r(a,e),c=Tt(a,t);return!o&&!c}),i=r.length;if(i>0&&n){let a=new Es(`${l("processingFiles")}: 0/${i}`),o=0;for(let c of r){if(a.cancelled)return new L.Notice(l("processCancelled")),o;await Ln(c,e,t,!1,!1,!0,!0),await Di(e,c),o++,a.updateMessage(`${l("processingFiles")}: ${o}/${i}`)}return a.hide(),await new Promise(c=>setTimeout(c,500)),i}return 0}async function Oi(s,e,t,n){let i=s.length,a=0,o=0;for(let u of s){let p=_r(u,t),m=Tt(u,n);if(!p&&!m){a+=1;let d=await Mi(u,t,n);if(d&&d.length>0){let f=St(d);o+=f.length+100}}}let c=0;if(e.length>0){for(let u of e){let p=await Er(u,t,n,!1);p&&_r(p,t,!1)||(c+=1)}o+=c*1e3}return{fileCount:a,dirCount:c,total:i,estimatedTokens:o}}async function Cr(s,e,t){let n=s.length,r=s.filter(p=>!_s(p,t.indexExcludeFile));if(r.length===0){new L.Notice(l("foundFilesNeedProcess").replace("{total}",n.toString()).replace("{count}","0"));return}let{fileCount:i,total:a,estimatedTokens:o}=await Oi(r,[],e,t),c=!1;if(o>0){let p="";i>0&&(p+=l("foundFilesNeedProcess").replace("{total}",a.toString()).replace("{count}",i.toString())+`

`),p+=l("estimatedTokens").replace("{tokens}",Math.ceil(o).toString()),c=await et(e,p,l("extract"),l("skip"))}if(c===void 0){new L.Notice(l("processCancelled"));return}let u=await Ni(r,e,t,c);new L.Notice(l("processComplete").replace("{count}",c?u.toString():"0"))}async function Cs(s,e,t){let n=e.vault.getMarkdownFiles().filter(d=>d.path.startsWith(s.path+"/")).filter(d=>!_s(d,t.indexExcludeFile)),r=e.vault.getAllLoadedFiles().filter(d=>(d.path.startsWith(s.path+"/")||d.path===s.path)&&d instanceof L.TFolder&&!_s(d,t.indexExcludeDir));r.sort((d,f)=>{let h=d.path.split("/").length;return f.path.split("/").length-h});let{fileCount:i,dirCount:a,total:o,estimatedTokens:c}=await Oi(n,r,e,t),u=!1;if(c>0){let d="";i>0&&(d+=l("foundFilesNeedProcess").replace("{total}",o.toString()).replace("{count}",i.toString())+`

`),a>0&&(d+=l("foundDirsNeedIndex").replace("{dirs}",a.toString())+`

`),d+=l("estimatedTokens").replace("{tokens}",Math.ceil(c).toString()),u=await et(e,d,l("extract"),l("skip"))}if(u===void 0){new L.Notice(l("processCancelled"));return}await Ni(n,e,t,u);let p=new Es(`${l("generatingIndex")}: 0/${r.length}`),m=0;for(let d of r){if(p.cancelled){new L.Notice(l("processCancelled")),p.hide();return}let f=await $o(d,e,t,u);u&&f&&await Di(e,f),m++,p.updateMessage(`${l("generatingIndex")}: ${m}/${r.length}`)}p.hide(),new L.Notice(l("processCompleteWithIndex").replace("{count}",u?i.toString():"0").replace("{dirs}",m.toString()))}async function Oo(s,e,t){var a,o,c,u;let n=[],r=e.vault.getAllLoadedFiles().filter(p=>p.parent===s&&p instanceof L.TFolder);r.sort((p,m)=>p.name.localeCompare(m.name));for(let p of r){let m=await Er(p,e,t,!1),d=m?e.metadataCache.getFileCache(m):null;n.push({name:p.name,path:p.path,isDir:!0,tags:((a=d==null?void 0:d.frontmatter)==null?void 0:a[t.metaTagsFieldName])||[],description:((o=d==null?void 0:d.frontmatter)==null?void 0:o[t.metaDescriptionFieldName])||l("noDescription"),indexFile:m})}let i=e.vault.getMarkdownFiles().filter(p=>p.parent===s).filter(p=>!Tt(p,t));i.sort((p,m)=>p.basename.localeCompare(m.basename));for(let p of i){let m=e.metadataCache.getFileCache(p);n.push({name:p.basename,path:p.path,isDir:!1,tags:((c=m==null?void 0:m.frontmatter)==null?void 0:c[t.metaTagsFieldName])||[],description:((u=m==null?void 0:m.frontmatter)==null?void 0:u[t.metaDescriptionFieldName])||l("noDescription"),file:p})}return n}async function $i(s,e,t,n,r=!0){let i={};for(let f of s)for(let h of f.tags||[])i[h]=(i[h]||0)+1;let a=Object.keys(i).sort((f,h)=>i[h]-i[f]);a=[l("moc"),...a],X(e,t,"tags",a,"append");let o=s.map(f=>{if(f.isDir){let h=f.indexFile?f.indexFile.path.replace(/ /g,"%20"):"";return f.indexFile?`- [${f.name}](${h})`:`- ${f.name}`}else{let h=f.path.replace(/ /g,"%20");return`- [${f.name}](${h})`}}).join(`
`),c=s.map(f=>{let h=f.isDir&&f.indexFile?f.indexFile.path.replace(/ /g,"%20"):f.path.replace(/ /g,"%20");return`${f.isDir&&f.indexFile?`- [${f.name}](${h})`:f.isDir?`- ${f.name}`:`- [${f.name}](${h})`}
  - ${f.description}`}).join(`
`),u="";for(let f of s)if(!f.isDir&&f.file)try{let g=await new Bn(t,f.file,n).readExistingCards();if(g&&g.length>0){let x=f.path.replace(/ /g,"%20");u+=`- [${f.name}](${x})
`,g.forEach(T=>{u+=T.format()+`

`})}}catch(h){console.error(`Error reading cards from ${f.path}:`,h)}let p=await t.vault.read(e),m="## "+l("fileList")+`
`+o;p=xs(p,l("fileList"),m);let d="## "+l("fileDetail")+`
`+c;if(p=xs(p,l("fileDetail"),d),u.trim()){let f="## "+l("cards")+`
`+u;p=xs(p,l("cards"),f)}return await t.vault.modify(e,p),await Ln(e,t,n,!1,!1,r,!1),e}async function Li(s,e,t,n=null){var p,m;let r=s.filter(d=>!_s(d,t.indexExcludeFile));if(r.length===0)return new L.Notice(l("foundFilesNeedProcess").replace("{total}",s.length.toString()).replace("{count}","0")+l("processCancelled")),null;await Cr(r,e,t);let i=[];for(let d of r){let f=e.metadataCache.getFileCache(d);i.push({name:d.basename,path:d.path,isDir:!1,tags:((p=f==null?void 0:f.frontmatter)==null?void 0:p[t.metaTagsFieldName])||[],description:((m=f==null?void 0:f.frontmatter)==null?void 0:m[t.metaDescriptionFieldName])||l("noDescription"),file:d})}i.sort((d,f)=>d.name.localeCompare(f.name));let a="";if(n){let d=n.replace(/[\/\\:*?"<>|#]/g,"_").replace(/\s+/g,"").replace(/_+/g,"_");d.length>20&&(d=d.slice(0,20)+"..."),a=`${t.defaultIndexString}${d}`}else{let d=new Date().toISOString().replace(/[:.]/g,"-");a=`${t.defaultIndexString}-${d.slice(0,10)}`}let o=`${a}.md`,c=t.indexFileDirectory,u="";if(c&&c!==""&&c!=="/"){if(c=c.replace(/\/$/,""),!e.vault.getAbstractFileByPath(c))try{await e.vault.createFolder(c)}catch(f){return console.error("Error creating directory:",f),null}u=`${c}/${o}`}else u=`${o}`;try{let d=e.vault.getAbstractFileByPath(u),f=!!d,h=n?n.replace(/"/g,'\\"'):"";if(d)X(d,e,"query",`"${h}"`,"update");else{let x=`---
tags: []
query: "${h}"
---

`;if(await e.vault.create(u,x),d=e.vault.getAbstractFileByPath(u),!d)return new L.Notice(l("failedToCreateIndex")),null}let g=await $i(i,d,e,t,!0);return f?new L.Notice(l("indexUpdated").replace("{path}",d.path)):new L.Notice(l("indexCreated").replace("{path}",d.path)),g}catch(d){return console.error("Error creating temp index:",d),new L.Notice(l("failedToCreateIndex")),null}}async function $o(s,e,t,n=!0){let r=await Oo(s,e,t),i=await Er(s,e,t);if(!i||!(i instanceof L.TFile))return console.log("failed to get file"),null;let a=`"path:${s.path}/"`;return X(i,e,"query",a,"update"),await $i(r,i,e,t,n)}async function Bi(s,e,t,n=!0){var i;let r=e.metadataCache.getFileCache(s);if(!r||!r.frontmatter||!r.frontmatter.query){let a=(i=e.vault.getAbstractFileByPath(s.path))==null?void 0:i.parent;a instanceof L.TFolder&&await Cs(a,e,t)}else{let a=r.frontmatter.query;if(a=a.replace(/['"]/g,""),a.startsWith("path:")){let o=a.slice(5).trim();o.endsWith("/")&&(o=o.slice(0,-1)),e.vault.getAbstractFileByPath(o)instanceof L.TFolder&&await Cs(parent,e,t)}else new L.Notice(l("indexQueryNotSupported"))}return null}var _e=require("obsidian");var Pr=class extends _e.SuggestModal{constructor(e,t){super(e),this.settings=t,this.inputValue="",this.modalEl.addClass("folder-suggest-modal");let n=this.modalEl.createDiv("dialog-button-container");n.addClass("dialog-button-container"),n.addClass("right-aligned"),this.confirmButton=n.createEl("button",{text:l("confirm")}),this.confirmButton.addEventListener("click",()=>{this.onConfirm()}),this.inputEl.addEventListener("input",r=>{this.inputValue=r.target.value}),this.emptyStateText=l("noFolders")}onChooseSuggestion(e,t){}onConfirm(){Lo(this.inputValue,this.app,this.settings),this.close()}renderSuggestion(e,t){t.createEl("div",{text:e})}getSuggestions(e){let t=this.app.vault.getAllFolders();t=t.filter(i=>i.path.includes(e));for(let i of this.settings.selectExcludedFolders)t=t.filter(a=>!a.path.startsWith(i));let n=t.map(i=>i.path),r={};return n.forEach(i=>{let a=(i.match(/\//g)||[]).length;r[i]=a}),n.sort((i,a)=>r[i]-r[a]),(e===""||l("allFolders").startsWith(e))&&(n=[l("allFolders"),...n]),n}handleKeyDown(e){if(e.key==="Tab"){let t=this.app.vault.getAllFolders();if(t=t.filter(n=>n.path.startsWith(this.inputEl.value)),t.length===0)return;this.inputEl.value=t[0].path}}onOpen(){super.onOpen(),this.inputEl.addEventListener("keydown",this.handleKeyDown.bind(this))}onClose(){this.inputEl.removeEventListener("keydown",this.handleKeyDown.bind(this)),super.onClose()}selectSuggestion(e,t){t.preventDefault(),this.inputEl.value=e,this.inputValue=e;let n=new InputEvent("input",{bubbles:!0,cancelable:!0});this.inputEl.dispatchEvent(n),this.inputEl.focus()}},Ar=class extends _e.Modal{constructor(e,t){super(e),this.options=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:l("pleaseSelectFolder")});let t=e.createEl("ul");this.options.forEach(n=>{let r=t.createEl("li");r.createEl("a",{text:n,attr:{href:"#"}}),r.addEventListener("click",i=>{i.preventDefault(),this.close();let a=this.app.workspace.getActiveFile();if(!a){new _e.Notice(l("pleaseOpenFile"));return}this.app.vault.rename(a,n+"/"+a.name),new _e.Notice(l("migrationSuccess"))})})}onClose(){let{contentEl:e}=this;e.empty()}};async function Lo(s,e,t){let n=e.workspace.getActiveFile();if(!n){new _e.Notice(l("pleaseOpenFile"));return}let r=e.vault.getAllFolders();if(s!==l("allFolders")){let o=e.vault.getFolderByPath(s);if(o==null){new _e.Notice(l("folderNotFound")+s);return}r=r.filter(c=>o&&c.path.startsWith(o.path))}for(let o of t.selectExcludedFolders)r=r.filter(c=>!c.path.startsWith(o));let i=[];if(r.length>=100){let o=`"${s}" ${l("tooManyFolders_1")}${r.length}${l("tooManyFolders_2")}`;if(!await et(e,o))return}if(r.length<=3)i=r.map(o=>o.path);else{let o=n.basename,c=e.metadataCache.getFileCache(n),u="";c!=null&&c.frontmatter!==null&&c.frontmatter!==void 0&&c.frontmatter.description?u=`The current file name is: '${o}'. The description is: '${c.frontmatter.description}'.`:u=`The current file name is: '${o}'.`,u+=`
Please help me find the three most suitable directories for storing this file, and return only the directory paths, separated by line breaks.

Below is the list of directory paths:
${r.map(m=>m.path).join(`
`)}
`;let p=await ne(u,t);if(p===""||p===void 0||p===null){new _e.Notice(l("noResult"));return}p=p.replace(/`/g,""),p=p.trim(),i=p.split(`
`),i=i.map(m=>m.trim())}new Ar(e,i).open()}async function Ui(s,e){let t=new Pr(s,e);t.setPlaceholder(l("searchDesc")),t.open()}var re=require("obsidian");function ji(s){var t;let e=(t=s.workspace.getActiveViewOfType(re.MarkdownView))==null?void 0:t.editor;return e?e.getSelection():""}function Bo(s,e){let t=e?Object.fromEntries(Object.entries(s).filter(([n])=>n.includes(e))):s;return Object.keys(t).sort((n,r)=>Is(t,n,r))}var Ps=class extends re.SuggestModal{constructor(e,t){super(e),this.plugin=t}onOpen(){let{inputEl:e}=this;e.type="text",e.placeholder=l("inputPrompt"),this.inputEl.dispatchEvent(new Event("input")),this.limit=30}getSuggestions(e){let t=this.plugin.settings,n=Bo(t.llmPrompts,e);return n.length===0?[e]:n}renderSuggestion(e,t){t.createEl("div",{text:e}).addClass("custom-suggestion-item")}onChooseSuggestion(e,t){if(e===""){new re.Notice(l("inputPrompt"));return}Wi(e,this.app,this.plugin)}},Sr=class extends Ps{constructor(e,t){super(e,t),this.modalEl.addClass("folder-suggest-modal");let n=this.modalEl.createDiv("dialog-button-container");n.addClass("dialog-button-container"),n.addClass("right-aligned"),this.chatButton=n.createEl("button",{text:l("chatButton")}),this.chatButton.addEventListener("click",()=>this.triggerChat())}onChooseSuggestion(e,t){}selectSuggestion(e,t){t.preventDefault(),this.inputEl.value=e;let n=new InputEvent("input",{bubbles:!0,cancelable:!0});this.inputEl.dispatchEvent(n),this.inputEl.focus()}triggerChat(){let e=this.inputEl.value;if(e===""){new re.Notice(l("inputPrompt"));return}Wi(e,this.app,this.plugin),this.close()}},Tr=class extends re.Modal{constructor(t,n,r,i){super(t);this.remember=!1;this.plugin=n,this.text=r,this.result=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("llm-result-container"),t.createEl("h3",{text:l("chooseAction")});let n=t.createDiv("llm-result-buttons");n.addClass("llm-result-modal-buttons"),n.createEl("button",{text:l("appendToSelection")}).addEventListener("click",()=>this.handleMode("append")),n.createEl("button",{text:l("prependToSelection")}).addEventListener("click",()=>this.handleMode("prepend")),n.createEl("button",{text:l("replaceSelection")}).addEventListener("click",()=>this.handleMode("replace"));let o=t.createDiv("llm-mode-remember");o.createEl("input",{type:"checkbox"}).addEventListener("change",u=>{this.remember=u.target.checked}),o.createSpan({text:l("rememberChoice")})}async handleMode(t){var r;let n=(r=this.app.workspace.getActiveViewOfType(re.MarkdownView))==null?void 0:r.editor;n&&(Vi(n,this.text,this.result,t),this.remember&&(this.plugin.settings.llmResultMode=t,await this.plugin.saveSettings()),this.close())}onClose(){let{contentEl:t}=this;t.empty()}};function Vi(s,e,t,n){switch(n){case"append":s.replaceSelection(e+`

`+t+`
`);break;case"prepend":s.replaceSelection(t+`

`+e);break;case"replace":s.replaceSelection(t);break}}async function Wi(s,e,t){var c;let n=t.settings,r=ji(e),i=`Prompt:
${s}

Content:
${r}`,a=await ne(i,n),o=(c=e.workspace.getActiveViewOfType(re.MarkdownView))==null?void 0:c.editor;o&&(n.llmResultMode!=="unknown"?Vi(o,r,a,n.llmResultMode):new Tr(e,t,r,a).open(),await Ms(t,s,1))}async function qi(s,e){if(ji(s)===""){new re.Notice(l("pleaseSelectText"));return}e.settings.llmDialogEdit?new Sr(s,e).open():new Ps(s,e).open()}var As=require("obsidian");async function Hi(s,e){var p;let t=(p=s.workspace.getActiveViewOfType(As.MarkdownView))==null?void 0:p.editor;if(!t)return;let n=t.getSelection();if(!n){new As.Notice(l("pleaseSelectText"));return}let i=n.split(`
`).filter(m=>m.trim()!==""),a=t.getValue();a.replace(n,"");let o=`
Please insert the following content into the appropriate place in the main text. Return the modified main text, and enclose the inserted content with double equals signs (==).
The content to be inserted is as follows:
${i.join(`
`)}
The markdown main text is as follows:
${a}
`,c=await ne(o,e);if(c===""||c===void 0||c===null)return;let u=c.match(/```markdown\s*([\s\S]*?)\s*```/);u&&(c=u[1]),t.setValue(c+`

`+l("insertContent")+`

`+n)}var Ji=require("obsidian");async function zi(s,e){let t=s.workspace.getActiveViewOfType(Ji.MarkdownView);if(!t)return;let n=t.editor,r=n.getCursor(),i=n.getSelection(),a=[],o=[],c;if(i)a=[i],c=n.getCursor("to");else{let T=n.getLine(r.line);for(let v=Math.max(0,r.line-2);v<r.line;v++){let R=n.getLine(v);R.trim()&&a.push(R)}let w=T.substring(0,r.ch);w.trim()&&a.push(w);let P=T.substring(r.ch);P.trim()&&o.push(P);let I=0,C=r.line+1;for(;C<n.lineCount()&&I<2;){let v=n.getLine(C);v.trim()&&(o.push(v),I++),C++}c=r}let u=100,p=100,m=a.join(" ").trim(),d=o.join(" ").trim(),f=m.length>u?"..."+m.slice(-u):m,h=d.length>p?d.slice(0,p)+"...":d,g=`Previous text: ${f}
Following text: ${h}`,x="Complete current sentence or generate a sentence (less than 50 words), based on the context:";try{let T=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],w=0,P=c;n.replaceRange(" ",P,P);let I=setInterval(()=>{let D={line:P.line,ch:P.ch+1};n.replaceRange(T[w],P,D),w=(w+1)%T.length},100),C=await ne(`${x}

${g}`,e,!1);clearInterval(I),n.replaceRange("",P,{line:P.line,ch:P.ch+1});let v=P;n.replaceRange(C,v,v);let R={line:c.line,ch:c.ch+C.length};n.setSelection(v,R)}catch(T){console.error("Error generating next sentence:",T)}}var Ss=class extends ke.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"adjust-meta",name:l("exmemoAdjustMeta"),editorCallback:(e,t)=>{this.adjustCurrentFileMeta(this.app,this.settings)}}),this.addCommand({id:"extract-zettelkasten",name:l("exmemoCreateZettelkasten"),editorCallback:(e,t)=>{ki(this.app,this.settings)}}),this.addCommand({id:"insert-dir",name:l("exmemoSelectFolder"),editorCallback:(e,t)=>{Ui(this.app,this.settings)}}),this.addCommand({id:"insert-md",name:l("exmemoInsertMd"),editorCallback:(e,t)=>{Hi(this.app,this.settings)}}),this.addCommand({id:"llm-assistant",name:l("exmemoLLMAssistant"),editorCallback:(e,t)=>{qi(this.app,this)}}),this.addCommand({id:"generate-next",name:l("exmemoGenerateNext"),editorCallback:(e,t)=>{zi(this.app,this.settings)}}),this.addSettingTab(new ws(this.app,this)),this.registerEvent(this.app.workspace.on("file-menu",(e,t)=>{t instanceof ke.TFolder&&e.addItem(n=>{n.setTitle(l("createIndex")).setIcon("plus").onClick(async()=>{await Cs(t,this.app,this.settings)})})})),this.registerEvent(this.app.workspace.on("search:results-menu",(e,t)=>{e.addItem(n=>{n.setIcon("tag").setTitle(l("addPropsToSearchResults")).onClick(async()=>{let r=this.getFilesFromSearch(t);if(!r.length){new ke.Notice(l("noFilesToProcess"),4e3);return}await Cr(r,this.app,this.settings)})})})),this.registerEvent(this.app.workspace.on("search:results-menu",(e,t)=>{e.addItem(n=>{n.setIcon("list").setTitle(l("createIndexFromSearch")).onClick(async()=>{var i;let r=this.getFilesFromSearch(t);if(!r.length){new ke.Notice(l("noFilesToProcess"),4e3);return}await Li(r,this.app,this.settings,(i=t==null?void 0:t.searchQuery)==null?void 0:i.query)})})}))}onunload(){}async loadSettings(){this.settings=Object.assign({},Mr,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async adjustCurrentFileMeta(e,t){let n=e.workspace.getActiveFile();if(!n){new ke.Notice(l("pleaseOpenFile"));return}if(n.extension!=="md"){new ke.Notice(l("currentFileNotMarkdown"));return}let r=t.metaUpdateMethod==="force";Tt(n,t)?await Bi(n,e,t,!0):await Ln(n,e,t,r,!0,!0,!1)}getFilesFromSearch(e){let t=[];return e.dom.vChildren.children.forEach(n=>{t.push(n.file)}),t}};

/* nosourcemap */